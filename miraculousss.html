<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miraculous - Ultimate Music Player</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }

        body {
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark {
            background: #0a0e27;
            color: #ffffff;
        }

        body.light {
            background: #f5f7fa;
            color: #1a202c;
        }

        .glass-morphism {
            transition: all 0.3s;
        }

        .dark .glass-morphism {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .light .glass-morphism {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }

        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.4);
        }

        .progress-bar {
            position: relative;
            height: 6px;
            background: rgba(128, 128, 128, 0.3);
            border-radius: 10px;
            cursor: pointer;
            overflow: visible;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            position: relative;
            transition: width 0.1s linear;
        }

        .progress-thumb {
            position: absolute;
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .progress-bar:hover .progress-thumb {
            opacity: 1;
        }

        .equalizer {
            display: flex;
            align-items: flex-end;
            height: 20px;
            gap: 3px;
        }

        .equalizer span {
            width: 3px;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 2px;
            animation: equalize 0.8s ease-in-out infinite;
        }

        .equalizer span:nth-child(1) { animation-delay: 0s; }
        .equalizer span:nth-child(2) { animation-delay: 0.2s; }
        .equalizer span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes equalize {
            0%, 100% { height: 4px; }
            50% { height: 20px; }
        }

        .play-pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            50% { box-shadow: 0 0 0 20px rgba(102, 126, 234, 0); }
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(128, 128, 128, 0.1);
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        .slide-in {
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .now-playing-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 600;
            z-index: 10;
        }

        .volume-slider {
            position: relative;
            width: 100px;
            height: 6px;
            background: rgba(128, 128, 128, 0.3);
            border-radius: 10px;
            cursor: pointer;
        }

        .volume-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.1s;
        }

        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 16px 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideInRight 0.3s ease-out;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .queue-item {
            transition: all 0.3s;
        }

        .queue-item:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateX(10px);
        }

        #sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 280px;
            z-index: 50;
            transition: transform 0.3s ease;
        }
        
        main {
            margin-left: 280px;
            transition: margin-left 0.3s ease;
        }
        
        @media (max-width: 1024px) {
            #sidebar {
                transform: translateX(-100%);
            }
            #sidebar.open {
                transform: translateX(0);
            }
            main {
                margin-left: 0;
            }
        }

        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 45;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 60;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s;
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
            transform: translate(-50%, -50%) scale(1);
        }

        .light .text-gray-400 {
            color: #6b7280 !important;
        }

        .light .text-white {
            color: #1a202c !important;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background-color: #4b5563;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .view-more-btn {
            transition: all 0.3s;
        }

        .view-more-btn:hover {
            transform: scale(1.05);
        }

        /* Light mode text colors */
        .light .nav-link {
            color: #4a5568;
        }

        .light .nav-link.active,
        .light .nav-link:hover {
            color: #667eea;
        }

        .dark .bg-blur {
            background: rgba(10, 14, 39, 0.95);
        }

        .light .bg-blur {
            background: rgba(255, 255, 255, 0.95);
        }
    </style>
</head>
<body class="dark">
    <!-- Mobile Menu Button -->
    <button id="menuToggle" class="lg:hidden fixed top-5 left-5 z-50 glass-morphism p-3 rounded-full hover:scale-110 transition-transform">
        <i class="fas fa-bars text-xl"></i>
    </button>

    <!-- Overlay -->
    <div id="overlay" class="overlay"></div>

    <!-- Background Effects -->
    <div class="fixed inset-0 pointer-events-none dark-only">
        <div class="absolute top-20 left-20 w-96 h-96 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse"></div>
        <div class="absolute bottom-20 right-20 w-96 h-96 bg-blue-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse" style="animation-delay: 1s;"></div>
        <div class="absolute top-1/2 left-1/2 w-96 h-96 bg-pink-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse" style="animation-delay: 2s;"></div>
    </div>

    <!-- Sidebar -->
    <aside id="sidebar" class="glass-morphism overflow-y-auto custom-scrollbar bg-blur">
        <div class="p-6">
            <!-- Logo -->
            <div class="flex items-center gap-3 mb-8">
                <div class="w-12 h-12 gradient-bg rounded-xl flex items-center justify-center text-2xl">
                    <i class="fas fa-music"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold gradient-text">Miraculous</h1>
                    <p class="text-xs text-gray-400">Music Player</p>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="space-y-2 mb-8">
                <a href="#discover" class="nav-link active flex items-center gap-3 px-4 py-3 rounded-xl transition-all gradient-bg">
                    <i class="fas fa-home w-5"></i>
                    <span class="font-medium">Discover</span>
                </a>
                <a href="#top-tracks" class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/10">
                    <i class="fas fa-fire w-5"></i>
                    <span class="font-medium">Top Tracks</span>
                </a>
                <a href="#albums" class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/10">
                    <i class="fas fa-record-vinyl w-5"></i>
                    <span class="font-medium">Albums</span>
                </a>
                <a href="#artists" class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/10">
                    <i class="fas fa-microphone w-5"></i>
                    <span class="font-medium">Artists</span>
                </a>
                <a href="#genres" class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/10">
                    <i class="fas fa-guitar w-5"></i>
                    <span class="font-medium">Genres</span>
                </a>
                <a href="#podcasts" class="nav-link flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/10">
                    <i class="fas fa-podcast w-5"></i>
                    <span class="font-medium">Podcasts</span>
                </a>
            </nav>

            <!-- Quick Actions -->
            <div class="space-y-2 mb-8">
                <h3 class="text-xs uppercase text-gray-400 font-semibold mb-3">Library</h3>
                <button onclick="showFavorites()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/10">
                    <i class="fas fa-heart w-5 text-red-400"></i>
                    <span class="font-medium">Favorites</span>
                    <span id="favCount" class="ml-auto text-xs bg-red-500/20 px-2 py-1 rounded-full">0</span>
                </button>
                <button onclick="showQueue()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/10">
                    <i class="fas fa-list w-5 text-purple-400"></i>
                    <span class="font-medium">Queue</span>
                    <span id="queueCount" class="ml-auto text-xs bg-purple-500/20 px-2 py-1 rounded-full">0</span>
                </button>
                <button onclick="showHistory()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/10">
                    <i class="fas fa-history w-5 text-blue-400"></i>
                    <span class="font-medium">History</span>
                </button>
                <button onclick="createPlaylist()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/10">
                    <i class="fas fa-plus w-5 text-green-400"></i>
                    <span class="font-medium">Create Playlist</span>
                </button>
            </div>

            <!-- Settings Section in Sidebar -->
            <div class="space-y-2 mb-8">
                <h3 class="text-xs uppercase text-gray-400 font-semibold mb-3">Settings</h3>
                <button onclick="downloadSongs()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/10">
                    <i class="fas fa-download w-5 text-yellow-400"></i>
                    <span class="font-medium">Download</span>
                </button>
                <button onclick="toggleTheme()" id="themeToggle" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/10">
                    <i class="fas fa-moon w-5 text-indigo-400"></i>
                    <span class="font-medium">Dark Mode</span>
                </button>
                <button onclick="showSettings()" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all hover:bg-white/10">
                    <i class="fas fa-cog w-5 text-gray-400"></i>
                    <span class="font-medium">Settings</span>
                </button>
            </div>

            <!-- Stats -->
            <div class="glass-morphism rounded-xl p-4">
                <h3 class="text-sm font-semibold mb-3">Your Stats</h3>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Songs Played</span>
                        <span id="songsPlayed" class="font-semibold">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Total Time</span>
                        <span id="totalTime" class="font-semibold">0:00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Favorites</span>
                        <span id="favTotal" class="font-semibold">0</span>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="min-h-screen pb-40">
        <!-- Header -->
        <header class="sticky top-0 z-30 glass-morphism px-6 py-4 mb-6 bg-blur">
            <div class="flex items-center gap-4 flex-wrap">
                <div class="flex-1 min-w-[200px] lg:ml-0 ml-12">
                    <div class="relative">
                        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="searchInput" placeholder="Search songs, artists, albums..." class="w-full pl-12 pr-12 py-3 glass-morphism rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all">
                        <button id="clearSearch" class="hidden absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <!-- Removed buttons from header since they're now in the sidebar -->
            </div>
        </header>

        <div class="px-6">
            <!-- Hero Section -->
            <section id="discover" class="mb-12 gradient-bg rounded-3xl p-8 lg:p-12 relative overflow-hidden">
                <div class="absolute inset-0 opacity-20">
                    <img src="https://images.unsplash.com/photo-1514525253161-7a46d19cd819?w=1200" class="w-full h-full object-cover">
                </div>
                <div class="relative z-10 max-w-2xl">
                    <h1 class="text-4xl lg:text-6xl font-bold mb-4">Discover Your Sound</h1>
                    <p class="text-lg opacity-90 mb-6">Explore millions of songs and create the perfect soundtrack for your life</p>
                    <div class="flex gap-4 flex-wrap">
                        <button onclick="playAll()" class="bg-white text-purple-600 px-8 py-3 rounded-full font-semibold hover:scale-105 transition-transform shadow-lg">
                            <i class="fas fa-play mr-2"></i>Play All
                        </button>
                        <button onclick="shuffleAll()" class="glass-morphism px-8 py-3 rounded-full font-semibold hover:scale-105 transition-transform">
                            <i class="fas fa-random mr-2"></i>Shuffle
                        </button>
                    </div>
                </div>
            </section>

            <!-- Quick Stats -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-12">
                <div class="glass-morphism rounded-2xl p-6 card-hover cursor-pointer" onclick="showFavorites()">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-heart text-xl"></i>
                        </div>
                        <div>
                            <p class="text-2xl font-bold" id="quickFavCount">0</p>
                            <p class="text-sm text-gray-400">Favorites</p>
                        </div>
                    </div>
                </div>
                <div class="glass-morphism rounded-2xl p-6 card-hover cursor-pointer">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-music text-xl"></i>
                        </div>
                        <div>
                            <p class="text-2xl font-bold">15</p>
                            <p class="text-sm text-gray-400">Total Songs</p>
                        </div>
                    </div>
                </div>
                <div class="glass-morphism rounded-2xl p-6 card-hover cursor-pointer" onclick="showHistory()">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-play text-xl"></i>
                        </div>
                        <div>
                            <p class="text-2xl font-bold" id="quickPlayedCount">0</p>
                            <p class="text-sm text-gray-400">Played</p>
                        </div>
                    </div>
                </div>
                <div class="glass-morphism rounded-2xl p-6 card-hover cursor-pointer" onclick="showQueue()">
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center">
                            <i class="fas fa-list text-xl"></i>
                        </div>
                        <div>
                            <p class="text-2xl font-bold" id="quickQueueCount">0</p>
                            <p class="text-sm text-gray-400">In Queue</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Now Playing Banner -->
            <div id="nowPlayingBanner" class="hidden mb-8 glass-morphism rounded-2xl p-6 border-2 border-purple-500">
                <div class="flex items-center gap-4">
                    <img id="bannerImage" class="w-20 h-20 rounded-xl object-cover" src="">
                    <div class="flex-1">
                        <p class="text-sm text-gray-400 mb-1">Now Playing</p>
                        <h3 id="bannerTitle" class="text-xl font-bold mb-1"></h3>
                        <p id="bannerArtist" class="text-gray-400"></p>
                    </div>
                    <div class="equalizer">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>

            <!-- Top Tracks -->
            <section id="top-tracks" class="mb-12">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">Top Tracks</h2>
                    <button onclick="toggleViewMore('topTracks')" class="text-purple-400 hover:text-purple-300 font-semibold view-more-btn">
                        <span class="view-more-text">View All</span>
                    </button>
                </div>
                <div id="topTracks" class="space-y-2"></div>
            </section>

            <!-- Featured Albums -->
            <section id="albums" class="mb-12">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">Featured Albums</h2>
                    <button onclick="toggleViewMore('featuredAlbums')" class="text-purple-400 hover:text-purple-300 font-semibold view-more-btn">
                        <span class="view-more-text">View All</span>
                    </button>
                </div>
                <div id="featuredAlbums" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4"></div>
            </section>

            <!-- Artists -->
            <section id="artists" class="mb-12">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">Featured Artists</h2>
                    <button onclick="toggleViewMore('featuredArtists')" class="text-purple-400 hover:text-purple-300 font-semibold view-more-btn">
                        <span class="view-more-text">View All</span>
                    </button>
                </div>
                <div id="featuredArtists" class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-6"></div>
            </section>

            <!-- Genres -->
            <section id="genres" class="mb-12">
                <h2 class="text-3xl font-bold mb-6">Browse Genres</h2>
                <div id="genreGrid" class="grid grid-cols-2 lg:grid-cols-4 gap-4"></div>
            </section>

            <!-- Podcasts -->
            <section id="podcasts" class="mb-12">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold">Popular Podcasts</h2>
                    <button onclick="toggleViewMore('podcastsList')" class="text-purple-400 hover:text-purple-300 font-semibold view-more-btn">
                        <span class="view-more-text">View All</span>
                    </button>
                </div>
                <div id="podcastsList" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4"></div>
            </section>
        </div>
    </main>

    <!-- Music Player -->
    <div class="fixed bottom-0 left-0 right-0 glass-morphism border-t border-white/10 px-6 py-4 z-50 bg-blur">
        <div class="max-w-screen-2xl mx-auto">
            <!-- Progress Bar -->
            <div class="mb-4">
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill" style="width: 0%">
                        <div class="progress-thumb"></div>
                    </div>
                </div>
                <div class="flex justify-between text-xs text-gray-400 mt-1">
                    <span id="currentTime">0:00</span>
                    <span id="duration">0:00</span>
                </div>
            </div>

            <div class="flex items-center justify-between gap-4">
                <!-- Song Info -->
                <div class="flex items-center gap-4 flex-1 min-w-0">
                    <img id="playerImage" src="https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=100" class="w-16 h-16 rounded-xl object-cover">
                    <div class="min-w-0 flex-1">
                        <h4 id="playerTitle" class="font-semibold truncate">Select a song</h4>
                        <p id="playerArtist" class="text-sm text-gray-400 truncate">Miraculous Music</p>
                    </div>
                    <button id="likeBtn" onclick="toggleLike()" class="text-gray-400 hover:text-red-400 transition-colors hidden lg:block">
                        <i class="far fa-heart text-xl"></i>
                    </button>
                </div>

                <!-- Controls -->
                <div class="flex items-center gap-4">
                    <button onclick="toggleShuffle()" id="shuffleBtn" class="text-gray-400 hover:text-white transition-colors hidden lg:block">
                        <i class="fas fa-random"></i>
                    </button>
                    <button onclick="playPrevious()" class="hover:scale-110 transition-transform">
                        <i class="fas fa-step-backward text-xl"></i>
                    </button>
                    <button id="playBtn" onclick="togglePlay()" class="w-14 h-14 gradient-bg rounded-full flex items-center justify-center hover:scale-110 transition-transform play-pulse">
                        <i class="fas fa-play text-xl ml-1"></i>
                    </button>
                    <button onclick="playNext()" class="hover:scale-110 transition-transform">
                        <i class="fas fa-step-forward text-xl"></i>
                    </button>
                    <button onclick="toggleRepeat()" id="repeatBtn" class="text-gray-400 hover:text-white transition-colors hidden lg:block">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>

                <!-- Volume & Actions -->
                <div class="hidden lg:flex items-center gap-4 flex-1 justify-end">
                    <button onclick="showLyrics()" class="text-gray-400 hover:text-white transition-colors" title="Lyrics">
                        <i class="fas fa-align-left"></i>
                    </button>
                    <button onclick="showQueue()" class="text-gray-400 hover:text-white transition-colors" title="Queue">
                        <i class="fas fa-list"></i>
                    </button>
                    <button onclick="toggleFullscreen()" class="text-gray-400 hover:text-white transition-colors" title="Fullscreen">
                        <i class="fas fa-expand"></i>
                    </button>
                    <div class="flex items-center gap-2">
                        <button onclick="toggleMute()" id="volumeIcon">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <div class="volume-slider" id="volumeSlider">
                            <div class="volume-fill" id="volumeFill" style="width: 70%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Queue Modal -->
    <div id="queueModal" class="modal glass-morphism rounded-2xl p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-2xl font-bold">Queue</h3>
            <button onclick="closeModal('queueModal')" class="text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div id="queueList" class="space-y-2 max-h-96 overflow-y-auto custom-scrollbar"></div>
    </div>

    <!-- Favorites Modal -->
    <div id="favoritesModal" class="modal glass-morphism rounded-2xl p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-2xl font-bold">Favorites</h3>
            <button onclick="closeModal('favoritesModal')" class="text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div id="favoritesList" class="space-y-2 max-h-96 overflow-y-auto custom-scrollbar"></div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal glass-morphism rounded-2xl p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-2xl font-bold">Play History</h3>
            <button onclick="closeModal('historyModal')" class="text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div id="historyList" class="space-y-2 max-h-96 overflow-y-auto custom-scrollbar"></div>
    </div>

    <!-- Lyrics Modal -->
    <div id="lyricsModal" class="modal glass-morphism rounded-2xl p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-2xl font-bold">Lyrics</h3>
            <button onclick="closeModal('lyricsModal')" class="text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div id="lyricsList" class="space-y-2 max-h-96 overflow-y-auto custom-scrollbar text-center">
            <p class="text-gray-400">Lyrics not available for this song</p>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal glass-morphism rounded-2xl p-6">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold">Settings</h3>
            <button onclick="closeModal('settingsModal')" class="text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="space-y-6">
            <div class="flex justify-between items-center">
                <div>
                    <h4 class="font-semibold">Auto Play Next</h4>
                    <p class="text-xs text-gray-400">Automatically play next song</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="autoPlayToggle" checked onchange="toggleAutoPlay()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="flex justify-between items-center">
                <div>
                    <h4 class="font-semibold">Show Notifications</h4>
                    <p class="text-xs text-gray-400">Display toast notifications</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="notificationToggle" checked onchange="toggleNotifications()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="flex justify-between items-center">
                <div>
                    <h4 class="font-semibold">Save Play History</h4>
                    <p class="text-xs text-gray-400">Track your listening history</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="historyToggle" checked onchange="toggleHistory()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div>
                <h4 class="font-semibold mb-3">Crossfade Duration</h4>
                <input type="range" id="crossfadeSlider" min="0" max="12" value="0" class="w-full">
                <p class="text-xs text-gray-400 mt-1"><span id="crossfadeValue">0</span> seconds</p>
            </div>
            <div>
                <h4 class="font-semibold mb-3">Audio Quality</h4>
                <select class="w-full glass-morphism rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <option>High (320kbps)</option>
                    <option selected>Normal (160kbps)</option>
                    <option>Low (96kbps)</option>
                </select>
            </div>
            <button onclick="clearAllData()" class="w-full bg-red-500/20 text-red-400 px-4 py-3 rounded-xl font-semibold hover:bg-red-500/30 transition-all">
                <i class="fas fa-trash mr-2"></i>Clear All Data
            </button>
        </div>
    </div>

    <!-- Create Playlist Modal -->
    <div id="createPlaylistModal" class="modal glass-morphism rounded-2xl p-6">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-2xl font-bold">Create Playlist</h3>
            <button onclick="closeModal('createPlaylistModal')" class="text-gray-400 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="space-y-4">
            <input type="text" id="playlistName" placeholder="Playlist name" class="w-full glass-morphism rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500">
            <textarea id="playlistDesc" placeholder="Description (optional)" rows="3" class="w-full glass-morphism rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500"></textarea>
            <button onclick="savePlaylist()" class="w-full gradient-bg px-4 py-3 rounded-xl font-semibold hover:scale-105 transition-transform">
                <i class="fas fa-save mr-2"></i>Create Playlist
            </button>
        </div>
    </div>

    <audio id="audioPlayer" preload="metadata"></audio>

    <script>
        // Enhanced Music Library
        const songs = [
            { id: 1, title: "Saiyaara Song", artist: "Faheem Abdullah", duration: "5:44", image: "https://c.saavncdn.com/598/Saiyaara-Hindi-2025-20250703061754-500x500.jpg", genre: "Romance", audio: "saiyaara.mp3" },
            { id: 2, title: "Deewaniyat Song", artist: "Vishal Mishra", duration: "3:22", image: "https://i.ytimg.com/vi/sIpLZNhD5J4/hq720.jpg", genre: "Romance", audio: "deewaniyat.mp3" },
            { id: 3, title: "Laal Pairi Song", artist: "Yo Yo Honey Singh", duration: "3:35", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQOE2YmYvrWGrXLMOzb5JK0V8BpAlrEEewBRoacCRg5GRTGYy5dP1r0w1U&s=10", genre: "Pop", audio: "laal-pari.mp3" },
            { id: 4, title: "Levitating", artist: "Dua Lipa", duration: "3:23", image: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=400", genre: "Pop", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3" },
            { id: 5, title: "Stay", artist: "The Kid LAROI, Justin Bieber", duration: "2:21", image: "https://images.unsplash.com/photo-1459749411175-04bf5292ceea?w=400", genre: "Pop", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3" },
            { id: 6, title: "Good 4 U", artist: "Olivia Rodrigo", duration: "2:58", image: "https://images.unsplash.com/photo-1483412033650-1015ddeb83d1?w=400", genre: "Pop Rock", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3" },
            { id: 7, title: "Montero", artist: "Lil Nas X", duration: "2:00", image: "https://images.unsplash.com/photo-1507874457470-272b3c8d8ee2?w=400", genre: "Hip Hop", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3" },
            { id: 8, title: "Kiss Me More", artist: "Doja Cat ft. SZA", duration: "3:28", image: "https://images.unsplash.com/photo-1514525253161-7a46d19cd819?w=400", genre: "Pop", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" },
            { id: 9, title: "Butter", artist: "BTS", duration: "2:42", image: "https://images.unsplash.com/photo-1598387993441-a364f854c3e1?w=400", genre: "K-Pop", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3" },
            { id: 10, title: "Industry Baby", artist: "Lil Nas X ft. Jack Harlow", duration: "3:32", image: "https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=400", genre: "Hip Hop", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3" },
            { id: 11, title: "Stay With Me", artist: "Calvin Harris", duration: "3:49", image: "https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=400", genre: "Electronic", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-11.mp3" },
            { id: 12, title: "Heat Waves", artist: "Glass Animals", duration: "3:59", image: "https://images.unsplash.com/photo-1516280440614-37939bbacd81?w=400", genre: "Indie Pop", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-12.mp3" },
            { id: 13, title: "Shivers", artist: "Ed Sheeran", duration: "3:27", image: "https://images.unsplash.com/photo-1506157786151-b8491531f063?w=400", genre: "Pop", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-13.mp3" },
            { id: 14, title: "Easy On Me", artist: "Adele", duration: "3:44", image: "https://images.unsplash.com/photo-1518199266791-5375a83190b7?w=400", genre: "Pop", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-14.mp3" },
            { id: 15, title: "Cold Heart", artist: "Elton John, Dua Lipa", duration: "3:22", image: "https://images.unsplash.com/photo-1477346611705-65d1883cee1e?w=400", genre: "Pop", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3" }
        ];

        const genres = [
            { name: "Pop", image: "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=600", color: "from-pink-500 to-rose-500" },
            { name: "Rock", image: "https://images.unsplash.com/photo-1498038432885-c6f3f1b912ee?w=600", color: "from-orange-500 to-red-500" },
            { name: "Hip Hop", image: "https://images.unsplash.com/photo-1571609167768-5d5c7f86c6c1?w=600", color: "from-purple-500 to-pink-500" },
            { name: "Electronic", image: "https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=600", color: "from-blue-500 to-cyan-500" },
            { name: "Jazz", image: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=600", color: "from-yellow-500 to-orange-500" },
            { name: "Classical", image: "https://images.unsplash.com/photo-1507838153414-b4b713384a76?w=600", color: "from-indigo-500 to-purple-500" },
            { name: "R&B", image: "https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=600", color: "from-red-500 to-pink-500" },
            { name: "Country", image: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=600", color: "from-green-500 to-emerald-500" }
        ];

        const podcasts = [
            { id: 1, title: "The Daily", artist: "The New York Times", duration: "25:00", image: "https://images.unsplash.com/photo-1478737270239-2f02b77fc618?w=400" },
            { id: 2, title: "Serial", artist: "This American Life", duration: "45:00", image: "https://images.unsplash.com/photo-1508700115892-45ecd05ae2ad?w=400" },
            { id: 3, title: "The Joe Rogan Experience", artist: "Joe Rogan", duration: "2:30:00", image: "https://images.unsplash.com/photo-1589903308904-1010c2294adc?w=400" },
            { id: 4, title: "Stuff You Should Know", artist: "HowStuffWorks", duration: "50:00", image: "https://images.unsplash.com/photo-1554260570-9140fd3b7614?w=400" },
            { id: 5, title: "Crime Junkie", artist: "audiochuck", duration: "40:00", image: "https://images.unsplash.com/photo-1563089145-599997674d42?w=400" },
            { id: 6, title: "TED Talks Daily", artist: "TED", duration: "20:00", image: "https://images.unsplash.com/photo-1551836026-d5c88ac5c4e0?w=400" }
        ];

        // State
        let currentSongIndex = 0;
        let isPlaying = false;
        let volume = 0.7;
        let isShuffle = false;
        let repeatMode = 0;
        let favorites = [];
        let queue = [];
        let history = [];
        let viewMoreStates = {};
        let totalPlayTime = 0;
        let autoPlay = true;
        let showNotifications = true;
        let saveHistory = true;
        let isDarkMode = true;

        // DOM Elements
        const audioPlayer = document.getElementById('audioPlayer');
        const playBtn = document.getElementById('playBtn');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeFill = document.getElementById('volumeFill');
        const searchInput = document.getElementById('searchInput');
        const clearSearch = document.getElementById('clearSearch');
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menuToggle');
        const overlay = document.getElementById('overlay');

        // Initialize
        function init() {
            audioPlayer.volume = volume;
            renderAllSections();
            attachEventListeners();
            loadUserData();
            updateStats();
            applyTheme();
        }

        function attachEventListeners() {
            audioPlayer.addEventListener('timeupdate', updateProgress);
            audioPlayer.addEventListener('ended', handleSongEnd);
            audioPlayer.addEventListener('loadedmetadata', updateDuration);
            progressBar.addEventListener('click', seek);
            volumeSlider.addEventListener('click', setVolume);
            searchInput.addEventListener('input', handleSearch);
            menuToggle.addEventListener('click', toggleSidebar);
            overlay.addEventListener('click', closeAllModals);

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboard);

            // Crossfade slider
            document.getElementById('crossfadeSlider').addEventListener('input', function(e) {
                document.getElementById('crossfadeValue').textContent = e.target.value;
            });

            // Clear search
            clearSearch.addEventListener('click', () => {
                searchInput.value = '';
                clearSearch.classList.add('hidden');
                renderAllSections();
            });

            // Nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.nav-link').forEach(l => {
                        l.classList.remove('active', 'gradient-bg');
                    });
                    this.classList.add('active', 'gradient-bg');
                    const href = this.getAttribute('href');
                    if (href && href.startsWith('#')) {
                        document.querySelector(href)?.scrollIntoView({ behavior: 'smooth' });
                    }
                    if (window.innerWidth < 1024) closeSidebar();
                });
            });
        }

        function renderAllSections() {
            renderTopTracks();
            renderFeaturedAlbums();
            renderFeaturedArtists();
            renderGenres();
            renderPodcasts();
        }

        function renderTopTracks() {
            const container = document.getElementById('topTracks');
            const isExpanded = viewMoreStates['topTracks'];
            const displaySongs = isExpanded ? songs : songs.slice(0, 10);

            container.innerHTML = displaySongs.map((song, index) => {
                const isCurrentlyPlaying = currentSongIndex === songs.findIndex(s => s.id === song.id) && isPlaying;
                const isFavorite = favorites.includes(song.id);
                return `
                    <div class="glass-morphism rounded-xl p-4 flex items-center gap-4 card-hover cursor-pointer slide-in" data-song-id="${song.id}" style="animation-delay: ${index * 0.05}s">
                        <div class="text-2xl font-bold text-purple-400 w-8">${index + 1}</div>
                        <div class="relative">
                            <img src="${song.image}" class="w-16 h-16 rounded-lg object-cover">
                            ${isCurrentlyPlaying ? '<div class="now-playing-indicator">NOW</div>' : ''}
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-semibold truncate">${song.title}</h4>
                            <p class="text-sm text-gray-400 truncate">${song.artist}</p>
                        </div>
                        ${isCurrentlyPlaying ? '<div class="equalizer"><span></span><span></span><span></span></div>' : ''}
                        <button onclick="event.stopPropagation(); toggleFavoriteSong(${song.id})" class="text-gray-400 hover:text-red-400 transition-colors">
                            <i class="${isFavorite ? 'fas' : 'far'} fa-heart"></i>
                        </button>
                        <div class="text-sm text-gray-400 hidden sm:block">${song.duration}</div>
                        <button onclick="event.stopPropagation(); addToQueue(${song.id})" class="text-gray-400 hover:text-purple-400 transition-colors">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                `;
            }).join('');
            attachSongListeners();
        }

        function renderFeaturedAlbums() {
            const container = document.getElementById('featuredAlbums');
            const isExpanded = viewMoreStates['featuredAlbums'];
            const displaySongs = isExpanded ? songs : songs.slice(0, 12);

            container.innerHTML = displaySongs.map(song => `
                <div class="glass-morphism rounded-xl overflow-hidden card-hover cursor-pointer" data-song-id="${song.id}">
                    <div class="relative aspect-square">
                        <img src="${song.image}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent opacity-0 hover:opacity-100 transition-opacity flex items-end p-4">
                            <button class="w-12 h-12 gradient-bg rounded-full flex items-center justify-center hover:scale-110 transition-transform">
                                <i class="fas fa-play ml-1"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-4">
                        <h4 class="font-semibold truncate mb-1">${song.title}</h4>
                        <p class="text-sm text-gray-400 truncate">${song.artist}</p>
                    </div>
                </div>
            `).join('');
            attachSongListeners();
        }

        function renderFeaturedArtists() {
            const container = document.getElementById('featuredArtists');
            const artists = [...new Set(songs.map(s => s.artist))];
            const isExpanded = viewMoreStates['featuredArtists'];
            const displayArtists = isExpanded ? artists : artists.slice(0, 8);

            container.innerHTML = displayArtists.map(artist => {
                const artistImage = songs.find(s => s.artist === artist).image;
                return `
                    <div class="text-center cursor-pointer hover:scale-105 transition-transform">
                        <div class="w-24 h-24 mx-auto mb-3 rounded-full overflow-hidden border-4 border-purple-500/50">
                            <img src="${artistImage}" class="w-full h-full object-cover">
                        </div>
                        <h4 class="font-semibold text-sm">${artist}</h4>
                    </div>
                `;
            }).join('');
        }

        function renderGenres() {
            const container = document.getElementById('genreGrid');
            container.innerHTML = genres.map(genre => `
                <div class="glass-morphism rounded-2xl p-6 card-hover cursor-pointer relative overflow-hidden h-32">
                    <div class="absolute inset-0 opacity-20">
                        <img src="${genre.image}" class="w-full h-full object-cover">
                    </div>
                    <div class="relative z-10">
                        <h3 class="text-2xl font-bold mb-2">${genre.name}</h3>
                        <div class="w-12 h-1 bg-gradient-to-r ${genre.color} rounded"></div>
                    </div>
                </div>
            `).join('');
        }

        function renderPodcasts() {
            const container = document.getElementById('podcastsList');
            const isExpanded = viewMoreStates['podcastsList'];
            const displayPodcasts = isExpanded ? podcasts : podcasts.slice(0, 6);

            container.innerHTML = displayPodcasts.map(podcast => `
                <div class="glass-morphism rounded-xl overflow-hidden card-hover cursor-pointer">
                    <div class="relative aspect-square">
                        <img src="${podcast.image}" class="w-full h-full object-cover">
                        <div class="absolute top-2 right-2 bg-red-500 px-2 py-1 rounded-full text-xs font-semibold">
                            PODCAST
                        </div>
                    </div>
                    <div class="p-4">
                        <h4 class="font-semibold truncate mb-1">${podcast.title}</h4>
                        <p class="text-sm text-gray-400 truncate">${podcast.artist}</p>
                        <p class="text-xs text-purple-400 mt-2">${podcast.duration}</p>
                    </div>
                </div>
            `).join('');
        }

        function attachSongListeners() {
            document.querySelectorAll('[data-song-id]').forEach(card => {
                card.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-song-id'));
                    playSongById(id);
                });
            });
        }

        // Player Functions
        function playSongById(id) {
            const index = songs.findIndex(s => s.id === id);
            if (index !== -1) {
                currentSongIndex = index;
                loadSong();
                playSong();
                if (saveHistory) addToHistory(id);
            }
        }

        function loadSong() {
            const song = songs[currentSongIndex];
            document.getElementById('playerImage').src = song.image;
            document.getElementById('playerTitle').textContent = song.title;
            document.getElementById('playerArtist').textContent = song.artist;
            document.getElementById('bannerImage').src = song.image;
            document.getElementById('bannerTitle').textContent = song.title;
            document.getElementById('bannerArtist').textContent = song.artist;

            audioPlayer.src = song.audio;
            audioPlayer.load();

            updateLikeButton();
            updateNowPlayingBanner();
            renderAllSections();
        }

        function playSong() {
            audioPlayer.play().then(() => {
                isPlaying = true;
                updatePlayButton();
                updateNowPlayingBanner();
            }).catch(error => {
                console.error('Playback error:', error);
                showNotif('Error playing song');
            });
        }

        function pauseSong() {
            audioPlayer.pause();
            isPlaying = false;
            updatePlayButton();
        }

        function togglePlay() {
            if (isPlaying) {
                pauseSong();
            } else {
                if (!audioPlayer.src) {
                    playSongById(songs[0].id);
                } else {
                    playSong();
                }
            }
        }

        function playNext() {
            if (queue.length > 0) {
                const nextId = queue.shift();
                updateQueueCount();
                playSongById(nextId);
            } else if (isShuffle) {
                currentSongIndex = Math.floor(Math.random() * songs.length);
                loadSong();
                playSong();
            } else {
                currentSongIndex = (currentSongIndex + 1) % songs.length;
                loadSong();
                playSong();
            }
        }

        function playPrevious() {
            currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
            loadSong();
            playSong();
        }

        function handleSongEnd() {
            totalPlayTime += audioPlayer.duration;
            updateStats();

            if (repeatMode === 2) {
                audioPlayer.currentTime = 0;
                playSong();
            } else if (autoPlay) {
                playNext();
            } else {
                isPlaying = false;
                updatePlayButton();
            }
        }

        function updateProgress() {
            const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
            progressFill.style.width = percent + '%';
            document.getElementById('currentTime').textContent = formatTime(audioPlayer.currentTime);
        }

        function updateDuration() {
            document.getElementById('duration').textContent = formatTime(audioPlayer.duration);
        }

        function seek(e) {
            const rect = progressBar.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            audioPlayer.currentTime = percent * audioPlayer.duration;
        }

        function setVolume(e) {
            const rect = volumeSlider.getBoundingClientRect();
            const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
            volume = percent;
            volumeFill.style.width = percent * 100 + '%';
            audioPlayer.volume = volume;
            updateVolumeIcon();
            saveUserData();
        }

        function toggleMute() {
            if (volume > 0) {
                audioPlayer.dataset.prevVolume = volume;
                volume = 0;
                audioPlayer.volume = 0;
                volumeFill.style.width = '0%';
            } else {
                volume = parseFloat(audioPlayer.dataset.prevVolume) || 0.7;
                audioPlayer.volume = volume;
                volumeFill.style.width = volume * 100 + '%';
            }
            updateVolumeIcon();
        }

        function updateVolumeIcon() {
            const icon = document.getElementById('volumeIcon').querySelector('i');
            if (volume === 0) {
                icon.className = 'fas fa-volume-mute';
            } else if (volume < 0.5) {
                icon.className = 'fas fa-volume-down';
            } else {
                icon.className = 'fas fa-volume-up';
            }
        }

        function toggleShuffle() {
            isShuffle = !isShuffle;
            const btn = document.getElementById('shuffleBtn');
            btn.classList.toggle('text-purple-400', isShuffle);
            btn.classList.toggle('text-gray-400', !isShuffle);
            showNotif(isShuffle ? 'Shuffle ON' : 'Shuffle OFF');
        }

        function toggleRepeat() {
            repeatMode = (repeatMode + 1) % 3;
            const btn = document.getElementById('repeatBtn');
            const icon = btn.querySelector('i');

            btn.classList.remove('text-purple-400', 'text-gray-400');

            if (repeatMode === 0) {
                btn.classList.add('text-gray-400');
                icon.className = 'fas fa-redo';
                showNotif('Repeat OFF');
            } else if (repeatMode === 1) {
                btn.classList.add('text-purple-400');
                icon.className = 'fas fa-redo';
                showNotif('Repeat All');
            } else {
                btn.classList.add('text-purple-400');
                btn.innerHTML = '<i class="fas fa-redo"></i><sup class="text-xs ml-0.5">1</sup>';
                showNotif('Repeat One');
            }
        }

        function toggleLike() {
            if (songs[currentSongIndex]) {
                toggleFavoriteSong(songs[currentSongIndex].id);
            }
        }

        function toggleFavoriteSong(id) {
            if (favorites.includes(id)) {
                favorites = favorites.filter(fid => fid !== id);
                showNotif('Removed from Favorites');
            } else {
                favorites.push(id);
                showNotif('Added to Favorites');
            }
            updateLikeButton();
            updateStats();
            renderAllSections();
            saveUserData();
        }

        function updateLikeButton() {
            const btn = document.getElementById('likeBtn');
            if (songs[currentSongIndex]) {
                const isFav = favorites.includes(songs[currentSongIndex].id);
                btn.querySelector('i').className = isFav ? 'fas fa-heart' : 'far fa-heart';
                btn.classList.toggle('text-red-400', isFav);
            }
        }

        function updatePlayButton() {
            const icon = playBtn.querySelector('i');
            icon.className = isPlaying ? 'fas fa-pause text-xl' : 'fas fa-play text-xl ml-1';
        }

        function updateNowPlayingBanner() {
            const banner = document.getElementById('nowPlayingBanner');
            if (isPlaying) {
                banner.classList.remove('hidden');
            } else {
                banner.classList.add('hidden');
            }
        }

        // Queue Functions
        function addToQueue(id) {
            if (!queue.includes(id)) {
                queue.push(id);
                updateQueueCount();
                showNotif('Added to Queue');
                saveUserData();
            }
        }

        function updateQueueCount() {
            document.getElementById('queueCount').textContent = queue.length;
            document.getElementById('quickQueueCount').textContent = queue.length;
        }

        function showQueue() {
            const list = document.getElementById('queueList');
            if (queue.length === 0) {
                list.innerHTML = '<p class="text-gray-400 text-center py-8">Queue is empty</p>';
            } else {
                list.innerHTML = queue.map(id => {
                    const song = songs.find(s => s.id === id);
                    return `
                        <div class="queue-item glass-morphism rounded-xl p-3 flex items-center gap-3 cursor-pointer" onclick="playSongById(${id})">
                            <img src="${song.image}" class="w-12 h-12 rounded-lg object-cover">
                            <div class="flex-1">
                                <h4 class="font-semibold text-sm">${song.title}</h4>
                                <p class="text-xs text-gray-400">${song.artist}</p>
                            </div>
                            <button onclick="event.stopPropagation(); removeFromQueue(${id})" class="text-gray-400 hover:text-red-400">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                }).join('');
            }
            openModal('queueModal');
        }

        function removeFromQueue(id) {
            queue = queue.filter(qid => qid !== id);
            updateQueueCount();
            showQueue();
            showNotif('Removed from Queue');
            saveUserData();
        }

        // Favorites Functions
        function showFavorites() {
            const list = document.getElementById('favoritesList');
            if (favorites.length === 0) {
                list.innerHTML = '<p class="text-gray-400 text-center py-8">No favorites yet</p>';
            } else {
                list.innerHTML = favorites.map(id => {
                    const song = songs.find(s => s.id === id);
                    return `
                        <div class="queue-item glass-morphism rounded-xl p-3 flex items-center gap-3 cursor-pointer" onclick="playSongById(${id})">
                            <img src="${song.image}" class="w-12 h-12 rounded-lg object-cover">
                            <div class="flex-1">
                                <h4 class="font-semibold text-sm">${song.title}</h4>
                                <p class="text-xs text-gray-400">${song.artist}</p>
                            </div>
                            <div class="text-xs text-gray-400">${song.duration}</div>
                            <button onclick="event.stopPropagation(); toggleFavoriteSong(${id})" class="text-red-400 hover:text-gray-400">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                    `;
                }).join('');
            }
            openModal('favoritesModal');
        }

        // History Functions
        function addToHistory(id) {
            history = history.filter(hid => hid !== id);
            history.unshift(id);
            if (history.length > 50) history.pop();
            saveUserData();
            updateStats();
        }

        function showHistory() {
            const list = document.getElementById('historyList');
            if (history.length === 0) {
                list.innerHTML = '<p class="text-gray-400 text-center py-8">No history yet</p>';
            } else {
                list.innerHTML = history.map(id => {
                    const song = songs.find(s => s.id === id);
                    return `
                        <div class="queue-item glass-morphism rounded-xl p-3 flex items-center gap-3 cursor-pointer" onclick="playSongById(${id})">
                            <img src="${song.image}" class="w-12 h-12 rounded-lg object-cover">
                            <div class="flex-1">
                                <h4 class="font-semibold text-sm">${song.title}</h4>
                                <p class="text-xs text-gray-400">${song.artist}</p>
                            </div>
                            <div class="text-xs text-gray-400">${song.duration}</div>
                        </div>
                    `;
                }).join('');
            }
            openModal('historyModal');
        }

        // Theme Functions
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            applyTheme();
            saveUserData();
        }

        function applyTheme() {
            const body = document.body;
            const icon = document.querySelector('#themeToggle i');
            const themeText = document.querySelector('#themeToggle span');
            
            if (isDarkMode) {
                body.classList.remove('light');
                body.classList.add('dark');
                icon.className = 'fas fa-moon w-5 text-indigo-400';
                themeText.textContent = 'Dark Mode';
            } else {
                body.classList.remove('dark');
                body.classList.add('light');
                icon.className = 'fas fa-sun w-5 text-yellow-400';
                themeText.textContent = 'Light Mode';
            }
        }

        // Settings Functions
        function showSettings() {
            openModal('settingsModal');
        }

        function toggleAutoPlay() {
            autoPlay = document.getElementById('autoPlayToggle').checked;
            showNotif(autoPlay ? 'Auto Play ON' : 'Auto Play OFF');
            saveUserData();
        }

        function toggleNotifications() {
            showNotifications = document.getElementById('notificationToggle').checked;
            saveUserData();
        }

        function toggleHistory() {
            saveHistory = document.getElementById('historyToggle').checked;
            showNotif(saveHistory ? 'History Tracking ON' : 'History Tracking OFF');
            saveUserData();
        }

        function clearAllData() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                favorites = [];
                queue = [];
                history = [];
                totalPlayTime = 0;
                localStorage.removeItem('miraculousMusicData');
                updateStats();
                renderAllSections();
                showNotif('All data cleared');
                closeModal('settingsModal');
            }
        }

        // Playlist Functions
        function createPlaylist() {
            openModal('createPlaylistModal');
        }

        function savePlaylist() {
            const name = document.getElementById('playlistName').value.trim();
            const desc = document.getElementById('playlistDesc').value.trim();
            
            if (!name) {
                showNotif('Please enter a playlist name');
                return;
            }
            
            showNotif('Playlist "' + name + '" created!');
            closeModal('createPlaylistModal');
            document.getElementById('playlistName').value = '';
            document.getElementById('playlistDesc').value = '';
        }

        // Extra Features
        function downloadSongs() {
            showNotif('Download feature coming soon!');
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                showNotif('Entered fullscreen mode');
            } else {
                document.exitFullscreen();
                showNotif('Exited fullscreen mode');
            }
        }

        function showLyrics() {
            openModal('lyricsModal');
        }

        // Search Functions
        function handleSearch(e) {
            const query = e.target.value.toLowerCase().trim();
            clearSearch.classList.toggle('hidden', !query);

            if (query) {
                const filtered = songs.filter(s =>
                    s.title.toLowerCase().includes(query) ||
                    s.artist.toLowerCase().includes(query) ||
                    s.genre.toLowerCase().includes(query)
                );
                displaySearchResults(filtered);
            } else {
                renderAllSections();
            }
        }

        function displaySearchResults(results) {
            const container = document.getElementById('topTracks');
            if (results.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center py-8">No results found</p>';
            } else {
                container.innerHTML = results.map((song, index) => {
                    const isFavorite = favorites.includes(song.id);
                    return `
                        <div class="glass-morphism rounded-xl p-4 flex items-center gap-4 card-hover cursor-pointer" data-song-id="${song.id}">
                            <div class="text-2xl font-bold text-purple-400 w-8">${index + 1}</div>
                            <img src="${song.image}" class="w-16 h-16 rounded-lg object-cover">
                            <div class="flex-1 min-w-0">
                                <h4 class="font-semibold truncate">${song.title}</h4>
                                <p class="text-sm text-gray-400 truncate">${song.artist}</p>
                            </div>
                            <button onclick="event.stopPropagation(); toggleFavoriteSong(${song.id})" class="text-gray-400 hover:text-red-400">
                                <i class="${isFavorite ? 'fas' : 'far'} fa-heart"></i>
                            </button>
                            <div class="text-sm text-gray-400 hidden sm:block">${song.duration}</div>
                        </div>
                    `;
                }).join('');
                attachSongListeners();
            }
        }

        // Modal Functions
        function openModal(id) {
            document.getElementById(id).classList.add('active');
            overlay.classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            overlay.classList.remove('active');
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('active');
            });
            overlay.classList.remove('active');
            closeSidebar();
        }

        // UI Functions
        function toggleSidebar() {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function closeSidebar() {
            sidebar.classList.remove('open');
            if (!document.querySelector('.modal.active')) {
                overlay.classList.remove('active');
            }
        }

        function toggleViewMore(section) {
            viewMoreStates[section] = !viewMoreStates[section];
            const btn = event.target.closest('button');
            const text = btn.querySelector('.view-more-text');
            
            if (viewMoreStates[section]) {
                text.textContent = 'View Less';
            } else {
                text.textContent = 'View All';
            }
            
            renderAllSections();
        }

        // Utility Functions
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function showNotif(message) {
            if (!showNotifications) return;
            const notif = document.createElement('div');
            notif.className = 'notification';
            notif.innerHTML = `<i class="fas fa-check-circle mr-2"></i>${message}`;
            document.body.appendChild(notif);
            setTimeout(() => {
                notif.style.opacity = '0';
                notif.style.transform = 'translateX(400px)';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        // Stats Functions
        function updateStats() {
            document.getElementById('favCount').textContent = favorites.length;
            document.getElementById('favTotal').textContent = favorites.length;
            document.getElementById('quickFavCount').textContent = favorites.length;
            document.getElementById('songsPlayed').textContent = history.length;
            document.getElementById('quickPlayedCount').textContent = history.length;
            
            const mins = Math.floor(totalPlayTime / 60);
            document.getElementById('totalTime').textContent = `${mins}:${Math.floor(totalPlayTime % 60)}`;
            
            updateQueueCount();
        }

        // Storage Functions
        function saveUserData() {
            const data = {
                favorites,
                queue,
                history,
                totalPlayTime,
                autoPlay,
                showNotifications,
                saveHistory,
                volume,
                isDarkMode,
                viewMoreStates
            };
            localStorage.setItem('miraculousMusicData', JSON.stringify(data));
        }

        function loadUserData() {
            const data = localStorage.getItem('miraculousMusicData');
            if (data) {
                const parsed = JSON.parse(data);
                favorites = parsed.favorites || [];
                queue = parsed.queue || [];
                history = parsed.history || [];
                totalPlayTime = parsed.totalPlayTime || 0;
                autoPlay = parsed.autoPlay !== undefined ? parsed.autoPlay : true;
                showNotifications = parsed.showNotifications !== undefined ? parsed.showNotifications : true;
                saveHistory = parsed.saveHistory !== undefined ? parsed.saveHistory : true;
                volume = parsed.volume || 0.7;
                isDarkMode = parsed.isDarkMode !== undefined ? parsed.isDarkMode : true;
                viewMoreStates = parsed.viewMoreStates || {};
                
                audioPlayer.volume = volume;
                volumeFill.style.width = volume * 100 + '%';
                
                // Update toggles
                document.getElementById('autoPlayToggle').checked = autoPlay;
                document.getElementById('notificationToggle').checked = showNotifications;
                document.getElementById('historyToggle').checked = saveHistory;
            }
        }

        // Keyboard Shortcuts
        function handleKeyboard(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

            switch(e.code) {
                case 'Space':
                    e.preventDefault();
                    togglePlay();
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    if (e.shiftKey) {
                        audioPlayer.currentTime += 10;
                    } else {
                        playNext();
                    }
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    if (e.shiftKey) {
                        audioPlayer.currentTime -= 10;
                    } else {
                        playPrevious();
                    }
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    volume = Math.min(1, volume + 0.1);
                    audioPlayer.volume = volume;
                    volumeFill.style.width = volume * 100 + '%';
                    updateVolumeIcon();
                    break;
                case 'ArrowDown':
                    e.preventDefault();
                    volume = Math.max(0, volume - 0.1);
                    audioPlayer.volume = volume;
                    volumeFill.style.width = volume * 100 + '%';
                    updateVolumeIcon();
                    break;
                case 'KeyM':
                    e.preventDefault();
                    toggleMute();
                    break;
                case 'KeyS':
                    e.preventDefault();
                    toggleShuffle();
                    break;
                case 'KeyR':
                    e.preventDefault();
                    toggleRepeat();
                    break;
                case 'KeyL':
                    e.preventDefault();
                    toggleLike();
                    break;
                case 'KeyQ':
                    e.preventDefault();
                    showQueue();
                    break;
                case 'KeyF':
                    e.preventDefault();
                    showFavorites();
                    break;
                case 'Escape':
                    e.preventDefault();
                    closeAllModals();
                    break;
            }
        }

        // Quick Actions
        function playAll() {
            currentSongIndex = 0;
            loadSong();
            playSong();
            showNotif('Playing all songs');
        }

        function shuffleAll() {
            isShuffle = true;
            const btn = document.getElementById('shuffleBtn');
            btn.classList.add('text-purple-400');
            btn.classList.remove('text-gray-400');
            
            currentSongIndex = Math.floor(Math.random() * songs.length);
            loadSong();
            playSong();
            showNotif('Shuffle mode activated');
        }

        // Window Events
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 1024) {
                closeSidebar();
            }
        });

        // Save data periodically
        setInterval(saveUserData, 30000);

        // Save data before unload
        window.addEventListener('beforeunload', saveUserData);

        // Initialize on load
        document.addEventListener('DOMContentLoaded', init);

        // Make functions global
        window.playSongById = playSongById;
        window.togglePlay = togglePlay;
        window.playNext = playNext;
        window.playPrevious = playPrevious;
        window.toggleLike = toggleLike;
        window.toggleFavoriteSong = toggleFavoriteSong;
        window.toggleShuffle = toggleShuffle;
        window.toggleRepeat = toggleRepeat;
        window.toggleMute = toggleMute;
        window.addToQueue = addToQueue;
        window.removeFromQueue = removeFromQueue;
        window.showQueue = showQueue;
        window.showFavorites = showFavorites;
        window.showHistory = showHistory;
        window.showLyrics = showLyrics;
        window.showSettings = showSettings;
        window.toggleAutoPlay = toggleAutoPlay;
        window.toggleNotifications = toggleNotifications;
        window.toggleHistory = toggleHistory;
        window.toggleViewMore = toggleViewMore;
        window.playAll = playAll;
        window.shuffleAll = shuffleAll;
        window.openModal = openModal;
        window.closeModal = closeModal;
        window.toggleTheme = toggleTheme;
        window.createPlaylist = createPlaylist;
        window.savePlaylist = savePlaylist;
        window.clearAllData = clearAllData;
        window.downloadSongs = downloadSongs;
        window.toggleFullscreen = toggleFullscreen;
    </script>
</body>
</html>
