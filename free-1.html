<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeoTube - YouTube-Style Video Platform</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-storage.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDfFIiUp2v2DmqMqP0SeVxs70x4tm7JUlI",
            authDomain: "my-private-project-cf41f.firebaseapp.com",
            projectId: "my-private-project-cf41f",
            storageBucket: "my-private-project-cf41f.firebasestorage.app",
            messagingSenderId: "1054856705673",
            appId: "1:1054856705673:web:aaa27fb45167fa0865b858"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // Make Firebase available globally
        window.firebase = {
            storage,
            ref,
            uploadBytesResumable,
            getDownloadURL,
            auth,
            provider,
            signInWithPopup
        };
    </script>
    
    <!-- Custom Configuration for Inter Font and Dark Mode -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-red': '#FF0000',
                        'dark-bg': '#0f0f0f',
                        'card-bg': '#272727',
                        'hover-bg': '#3f3f3f',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Ensuring the icons are rendered */
        [lucide] {
            stroke-width: 2.5;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #212121;
        }
        ::-webkit-scrollbar-thumb {
            background: #4F46E5;
            border-radius: 4px;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #272727;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* Line clamp for text overflow */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Video player styling */
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
        }
        .video-container iframe,
        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Custom file upload button */
        .file-upload {
            position: relative;
            display: inline-block;
            width: 100%;
        }
        .file-upload input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        /* Animation for loading */
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        .loading {
            animation: pulse 1.5s infinite;
        }
        
        /* Category filter buttons */
        .category-btn {
            transition: all 0.2s ease;
        }
        .category-btn.active {
            background-color: #3f3f3f;
            color: white;
        }
        .category-btn.selected {
            background-color: #4F46E5;
            color: white;
        }
        
        /* Like animation */
        @keyframes like {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .liked {
            animation: like 0.3s ease;
            color: #3b82f6;
        }
        
        /* Progress bar for upload */
        .progress-bar {
            height: 6px;
            background-color: #3f3f3f;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background-color: #4F46E5;
            transition: width 0.3s ease;
        }
        
        /* Mobile menu */
        .mobile-menu {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #272727;
            border-top: 1px solid #3f3f3f;
            z-index: 100;
        }
        
        /* Shorts container */
        .shorts-container {
            display: none;
            width: 100%;
            margin: 0 auto;
        }
        .shorts-video {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            border-radius: 12px;
            overflow: hidden;
            display: none;
        }
        .shorts-video.active {
            display: block;
        }
        .shorts-video video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .shorts-controls {
            position: absolute;
            right: 10px;
            bottom: 80px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .shorts-control-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            background: transparent;
            border: none;
            cursor: pointer;
        }
        .shorts-control-btn i {
            margin-bottom: 5px;
            background: rgba(0,0,0,0.5);
            border-radius: 50%;
            padding: 8px;
        }
        .shorts-control-btn span {
            font-size: 12px;
        }
        
        /* Library container */
        .library-container {
            display: none;
        }
        
        /* Modern video player */
        .modern-player {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
        }
        .modern-player video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .player-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            padding: 10px;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .modern-player:hover .player-controls,
        .modern-player.controls-visible .player-controls {
            opacity: 1;
        }
        .progress-container {
            width: 100%;
            height: 5px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            margin-bottom: 10px;
            cursor: pointer;
            position: relative;
        }
        .progress-bar-player {
            height: 100%;
            background: #FF0000;
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s;
        }
        .progress-hover {
            position: absolute;
            height: 100%;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            width: 0%;
            pointer-events: none;
        }
        .control-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .left-controls, .right-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .control-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .volume-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .volume-slider {
            width: 70px;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }
        .volume-level {
            height: 100%;
            background: white;
            border-radius: 2px;
            width: 100%;
        }
        .time-display {
            font-size: 14px;
            color: white;
        }
        
        /* Fullscreen video player */
        .fullscreen-player {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 1001;
            display: none;
            flex-direction: column;
        }
        .fullscreen-video-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .fullscreen-video {
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .fullscreen-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            padding: 15px;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .fullscreen-player:hover .fullscreen-controls,
        .fullscreen-player.controls-visible .fullscreen-controls {
            opacity: 1;
        }
        .fullscreen-progress-container {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            margin-bottom: 15px;
            cursor: pointer;
            position: relative;
        }
        .fullscreen-progress-bar {
            height: 100%;
            background: #FF0000;
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s;
        }
        .fullscreen-progress-hover {
            position: absolute;
            height: 100%;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            width: 0%;
            pointer-events: none;
        }
        .fullscreen-control-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .fullscreen-left-controls, .fullscreen-right-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .fullscreen-control-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }
        .fullscreen-volume-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .fullscreen-volume-slider {
            width: 100px;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }
        .fullscreen-volume-level {
            height: 100%;
            background: white;
            border-radius: 2px;
            width: 100%;
        }
        .fullscreen-time-display {
            font-size: 16px;
            color: white;
        }
        
        /* Watch history */
        .history-item {
            display: flex;
            gap: 15px;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .history-item:hover {
            background: #3f3f3f;
        }
        .history-thumbnail {
            width: 160px;
            height: 90px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }
        .history-info {
            flex-grow: 1;
        }
        
        /* Playlist functionality */
        .playlist-item {
            display: flex;
            gap: 10px;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .playlist-item:hover {
            background: #3f3f3f;
        }
        .playlist-thumbnail {
            width: 120px;
            height: 68px;
            border-radius: 4px;
            object-fit: cover;
            flex-shrink: 0;
        }
        
        /* Shorts specific styles */
        .shorts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }
        .shorts-card {
            cursor: pointer;
            border-radius: 12px;
            overflow: hidden;
            transition: transform 0.2s;
        }
        .shorts-card:hover {
            transform: scale(1.03);
        }
        .shorts-thumbnail {
            width: 100%;
            aspect-ratio: 9/16;
            object-fit: cover;
            border-radius: 12px;
        }
        .shorts-info {
            padding: 8px 0;
        }
        .shorts-title {
            font-weight: 600;
            margin-bottom: 4px;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .shorts-views {
            color: #aaa;
            font-size: 14px;
        }
        .delete-btn {
            background: #dc2626;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 8px;
        }
        .delete-btn:hover {
            background: #b91c1c;
        }
        
        /* Fullscreen shorts player */
        .fullscreen-shorts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 1002;
            display: none;
        }
        .shorts-player {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .shorts-player video {
            width: 100%;
            height: 100%;
            max-width: 500px;
            max-height: 100%;
            object-fit: contain;
        }
        .shorts-player-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
        }
        .back-btn {
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        /* Multi-category selection */
        .category-selection {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        .category-tag {
            display: inline-flex;
            align-items: center;
            background: #4F46E5;
            color: white;
            padding: 4px 8px;
            border-radius: 16px;
            font-size: 12px;
            margin-right: 4px;
            margin-bottom: 4px;
        }
        .category-tag-remove {
            margin-left: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        /* Improved video player */
        .player-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.5);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .modern-player:hover .player-overlay {
            opacity: 1;
        }
        .play-pause-overlay {
            width: 70px;
            height: 70px;
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .play-pause-overlay i {
            color: white;
            width: 30px;
            height: 30px;
        }
        .quality-selector {
            position: relative;
        }
        .quality-menu {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: #272727;
            border-radius: 8px;
            padding: 8px;
            min-width: 120px;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .quality-menu.show {
            display: block;
        }
        .quality-option {
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
        }
        .quality-option:hover {
            background: #3f3f3f;
        }
        .quality-option.active {
            background: #4F46E5;
        }
        
        /* Video thumbnail preview */
        .thumbnail-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }
        
        /* Auth styles */
        .auth-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 10px;
        }
        .google-auth-btn {
            background: white;
            color: #333;
            border: 1px solid #ddd;
        }
        .google-auth-btn:hover {
            background: #f5f5f5;
        }
        .email-auth-btn {
            background: #4F46E5;
            color: white;
            border: none;
        }
        .email-auth-btn:hover {
            background: #4338CA;
        }
        
        @media (max-width: 768px) {
            .mobile-menu {
                display: flex;
            }
            .history-thumbnail {
                width: 120px;
                height: 68px;
            }
            .playlist-thumbnail {
                width: 80px;
                height: 45px;
            }
            .shorts-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
        
        /* Desktop Sidebar Styles */
        #desktop-sidebar {
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }
        
        /* Ensure content doesn't get hidden behind sidebar */
        @media (min-width: 768px) {
            main {
                margin-left: 256px;
                transition: margin-left 0.3s ease;
            }
        }
        
        /* Remove any mobile sidebar styles we don't need */
        #mobile-sidebar,
        #mobile-sidebar-overlay {
            display: none !important;
        }
    </style>
</head>
<body class="bg-dark-bg text-white font-sans min-h-screen">

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">Welcome to NeoTube</h2>
            <p class="text-gray-300 mb-6">Sign in to upload and manage your videos</p>
            
            <button id="google-auth-btn" class="auth-btn google-auth-btn">
                <i data-lucide="log-in" class="w-5 h-5"></i>
                Continue with Google
            </button>
            
            <div class="relative my-4">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-600"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                    <span class="px-2 bg-dark-bg text-gray-400">Or</span>
                </div>
            </div>
            
            <button id="email-auth-btn" class="auth-btn email-auth-btn">
                <i data-lucide="mail" class="w-5 h-5"></i>
                Continue with Email
            </button>
        </div>
    </div>

    <!-- Username Modal -->
    <div id="username-modal" class="modal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">Complete Your Profile</h2>
            <p class="text-gray-300 mb-6">Please choose a username to continue:</p>
            <input type="text" id="username-input" placeholder="Enter your username" 
                   class="w-full p-3 rounded-lg bg-card-bg border border-gray-600 focus:ring-2 focus:ring-primary-red focus:border-transparent outline-none transition duration-200 mb-4">
            <button id="save-username" class="w-full bg-primary-red hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                Continue
            </button>
        </div>
    </div>

    <!-- Upload Video Modal -->
    <div id="upload-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Upload Video</h2>
                <button id="close-upload-modal" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <!-- Upload Type Selection -->
            <div class="mb-6">
                <div class="flex space-x-4 border-b border-gray-700">
                    <button id="upload-video-tab" class="pb-2 px-1 font-medium border-b-2 border-primary-red text-primary-red">Regular Video</button>
                    <button id="upload-shorts-tab" class="pb-2 px-1 font-medium text-gray-400 hover:text-white transition duration-200">Shorts</button>
                </div>
            </div>
            
            <!-- Regular Video Upload Form -->
            <form id="upload-form" class="space-y-4 upload-type-form active">
                <div>
                    <label for="video-url" class="block text-sm font-medium mb-1">Video URL (Optional)</label>
                    <input type="url" id="video-url"
                           class="w-full p-3 rounded-lg bg-card-bg border border-gray-600 focus:ring-2 focus:ring-primary-red focus:border-transparent outline-none transition duration-200"
                           placeholder="https://example.com/video.mp4">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Or Upload Video File (Max 100MB)</label>
                    <div class="file-upload">
                        <input type="file" id="video-file" accept="video/*,.mp4,.webm,.mov,.mkv,.avi,.3gp,.ogg">
                        <div class="w-full p-3 rounded-lg bg-card-bg border border-gray-600 text-center cursor-pointer hover:bg-hover-bg transition duration-200">
                            <i data-lucide="upload" class="w-5 h-5 inline-block mr-2"></i>
                            <span id="file-name">Choose video file</span>
                        </div>
                    </div>
                    <img id="thumbnail-preview" class="thumbnail-preview" alt="Video thumbnail preview">
                    <div id="upload-progress" class="mt-2 hidden">
                        <div class="progress-bar">
                            <div id="progress-bar-fill" class="progress-bar-fill" style="width: 0%"></div>
                        </div>
                        <p id="upload-status" class="text-xs text-gray-400 mt-1">Uploading: 0%</p>
                    </div>
                </div>
                <div>
                    <label for="video-title" class="block text-sm font-medium mb-1">Video Title</label>
                    <input type="text" id="video-title" required
                           class="w-full p-3 rounded-lg bg-card-bg border border-gray-600 focus:ring-2 focus:ring-primary-red focus:border-transparent outline-none transition duration-200"
                           placeholder="Enter video title">
                </div>
                <div>
                    <label for="video-description" class="block text-sm font-medium mb-1">Description</label>
                    <textarea id="video-description" required maxlength="1500"
                              class="w-full p-3 rounded-lg bg-card-bg border border-gray-600 focus:ring-2 focus:ring-primary-red focus:border-transparent outline-none transition duration-200 h-32 resize-none"
                              placeholder="Enter video description"></textarea>
                    <div class="text-right text-xs text-gray-400 mt-1">
                        <span id="char-count">0</span>/1500 characters
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Select Categories (Max 4)</label>
                    <div class="category-selection" id="selected-categories">
                        <!-- Selected categories will appear here -->
                    </div>
                    <div class="flex flex-wrap gap-2 mt-2">
                        <button type="button" class="category-select-btn px-3 py-1 bg-card-bg rounded-full text-sm" data-category="scifi">Sci-Fi</button>
                        <button type="button" class="category-select-btn px-3 py-1 bg-card-bg rounded-full text-sm" data-category="fantasy">Fantasy</button>
                        <button type="button" class="category-select-btn px-3 py-1 bg-card-bg rounded-full text-sm" data-category="comedy">Comedy</button>
                        <button type="button" class="category-select-btn px-3 py-1 bg-card-bg rounded-full text-sm" data-category="drama">Drama</button>
                        <button type="button" class="category-select-btn px-3 py-1 bg-card-bg rounded-full text-sm" data-category="movie">Movie</button>
                        <button type="button" class="category-select-btn px-3 py-1 bg-card-bg rounded-full text-sm" data-category="romance">Romance</button>
                        <button type="button" class="category-select-btn px-3 py-1 bg-card-bg rounded-full text-sm" data-category="action">Action</button>
                        <button type="button" class="category-select-btn px-3 py-1 bg-card-bg rounded-full text-sm" data-category="thriller">Thriller</button>
                    </div>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="cancel-upload" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition duration-200">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-primary-red hover:bg-red-700 rounded-lg transition duration-200">
                        Upload Video
                    </button>
                </div>
            </form>
            
            <!-- Shorts Upload Form -->
            <form id="upload-shorts-form" class="space-y-4 upload-type-form hidden">
                <div>
                    <label for="shorts-url" class="block text-sm font-medium mb-1">Shorts Video URL (Optional)</label>
                    <input type="url" id="shorts-url"
                           class="w-full p-3 rounded-lg bg-card-bg border border-gray-600 focus:ring-2 focus:ring-primary-red focus:border-transparent outline-none transition duration-200"
                           placeholder="https://example.com/shorts.mp4">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Or Upload Shorts Video (Max 50MB)</label>
                    <div class="file-upload">
                        <input type="file" id="shorts-file" accept="video/*,.mp4,.webm,.mov,.mkv,.avi,.3gp,.ogg">
                        <div class="w-full p-3 rounded-lg bg-card-bg border border-gray-600 text-center cursor-pointer hover:bg-hover-bg transition duration-200">
                            <i data-lucide="upload" class="w-5 h-5 inline-block mr-2"></i>
                            <span id="shorts-file-name">Choose shorts video</span>
                        </div>
                    </div>
                    <img id="shorts-thumbnail-preview" class="thumbnail-preview" alt="Shorts thumbnail preview">
                    <div id="shorts-upload-progress" class="mt-2 hidden">
                        <div class="progress-bar">
                            <div id="shorts-progress-bar-fill" class="progress-bar-fill" style="width: 0%"></div>
                        </div>
                        <p id="shorts-upload-status" class="text-xs text-gray-400 mt-1">Uploading: 0%</p>
                    </div>
                </div>
                <div>
                    <label for="shorts-title" class="block text-sm font-medium mb-1">Shorts Title</label>
                    <input type="text" id="shorts-title" required
                           class="w-full p-3 rounded-lg bg-card-bg border border-gray-600 focus:ring-2 focus:ring-primary-red focus:border-transparent outline-none transition duration-200"
                           placeholder="Enter shorts title">
                </div>
                <div>
                    <label for="shorts-description" class="block text-sm font-medium mb-1">Description (Max 150 words)</label>
                    <textarea id="shorts-description" required maxlength="900"
                              class="w-full p-3 rounded-lg bg-card-bg border border-gray-600 focus:ring-2 focus:ring-primary-red focus:border-transparent outline-none transition duration-200 h-24 resize-none"
                              placeholder="Enter shorts description"></textarea>
                    <div class="text-right text-xs text-gray-400 mt-1">
                        <span id="shorts-char-count">0</span>/900 characters
                    </div>
                </div>
                <div class="flex justify-end space-x-3 pt-4">
                    <button type="button" id="cancel-shorts-upload" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition duration-200">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-primary-red hover:bg-red-700 rounded-lg transition duration-200">
                        Upload Shorts
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Video Player Modal -->
    <div id="video-player-modal" class="modal">
        <div class="modal-content w-full max-w-4xl">
            <div class="flex justify-between items-center mb-4">
                <h2 id="player-video-title" class="text-xl font-bold"></h2>
                <button id="close-player-modal" class="text-gray-400 hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="modern-player mb-4" id="normal-player">
                <video id="fullscreen-video">
                    Your browser does not support the video tag.
                </video>
                <div class="player-overlay">
                    <div class="play-pause-overlay" id="play-pause-overlay">
                        <i data-lucide="play" class="w-8 h-8"></i>
                    </div>
                </div>
                <div class="player-controls">
                    <div class="progress-container" id="progress-container">
                        <div class="progress-bar-player" id="progress-bar-player"></div>
                        <div class="progress-hover" id="progress-hover"></div>
                    </div>
                    <div class="control-buttons">
                        <div class="left-controls">
                            <button id="player-play-btn" class="control-btn">
                                <i data-lucide="play" class="w-5 h-5"></i>
                            </button>
                            <div class="volume-container">
                                <button id="player-mute-btn" class="control-btn">
                                    <i data-lucide="volume-2" class="w-5 h-5"></i>
                                </button>
                                <div class="volume-slider" id="volume-slider">
                                    <div class="volume-level" id="volume-level"></div>
                                </div>
                            </div>
                            <div class="time-display">
                                <span id="current-time">0:00</span> / <span id="duration-time">0:00</span>
                            </div>
                        </div>
                        <div class="right-controls">
                            <div class="quality-selector">
                                <button id="player-quality-btn" class="control-btn">
                                    <i data-lucide="settings" class="w-5 h-5"></i>
                                    <span>Quality</span>
                                </button>
                                <div class="quality-menu" id="quality-menu">
                                    <div class="quality-option active" data-quality="auto">Auto</div>
                                    <div class="quality-option" data-quality="1080">1080p</div>
                                    <div class="quality-option" data-quality="720">720p</div>
                                    <div class="quality-option" data-quality="480">480p</div>
                                </div>
                            </div>
                            <button id="player-fullscreen-btn" class="control-btn">
                                <i data-lucide="maximize" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-card-bg p-4 rounded-lg">
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <button id="player-like-btn" class="flex items-center space-x-1 text-gray-400 hover:text-white">
                                <i data-lucide="thumbs-up" class="w-5 h-5"></i>
                                <span id="player-likes-count">0</span>
                            </button>
                            <button id="player-dislike-btn" class="flex items-center space-x-1 text-gray-400 hover:text-white">
                                <i data-lucide="thumbs-down" class="w-5 h-5"></i>
                                <span id="player-dislikes-count">0</span>
                            </button>
                        </div>
                        <button id="player-share-btn" class="flex items-center space-x-1 text-gray-400 hover:text-white">
                            <i data-lucide="share" class="w-5 h-5"></i>
                            <span>Share</span>
                        </button>
                    </div>
                    <button id="player-delete-btn" class="delete-btn hidden">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                        Delete
                    </button>
                </div>
                <div class="mt-4">
                    <h3 class="font-bold mb-2">Description</h3>
                    <p id="player-video-description" class="text-gray-300 text-sm"></p>
                    <div id="player-video-categories" class="flex flex-wrap gap-2 mt-2"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fullscreen Video Player -->
    <div id="fullscreen-player" class="fullscreen-player">
        <div class="fullscreen-video-container">
            <video id="fullscreen-video-player" class="fullscreen-video">
                Your browser does not support the video tag.
            </video>
        </div>
        <div class="fullscreen-controls">
            <div class="fullscreen-progress-container" id="fullscreen-progress-container">
                <div class="fullscreen-progress-bar" id="fullscreen-progress-bar"></div>
                <div class="fullscreen-progress-hover" id="fullscreen-progress-hover"></div>
            </div>
            <div class="fullscreen-control-buttons">
                <div class="fullscreen-left-controls">
                    <button id="fullscreen-play-btn" class="fullscreen-control-btn">
                        <i data-lucide="play" class="w-6 h-6"></i>
                    </button>
                    <div class="fullscreen-volume-container">
                        <button id="fullscreen-mute-btn" class="fullscreen-control-btn">
                            <i data-lucide="volume-2" class="w-6 h-6"></i>
                        </button>
                        <div class="fullscreen-volume-slider" id="fullscreen-volume-slider">
                            <div class="fullscreen-volume-level" id="fullscreen-volume-level"></div>
                        </div>
                    </div>
                    <div class="fullscreen-time-display">
                        <span id="fullscreen-current-time">0:00</span> / <span id="fullscreen-duration-time">0:00</span>
                    </div>
                </div>
                <div class="fullscreen-right-controls">
                    <div class="quality-selector">
                        <button id="fullscreen-quality-btn" class="fullscreen-control-btn">
                            <i data-lucide="settings" class="w-6 h-6"></i>
                            <span>Quality</span>
                        </button>
                        <div class="quality-menu" id="fullscreen-quality-menu">
                            <div class="quality-option active" data-quality="auto">Auto</div>
                            <div class="quality-option" data-quality="1080">1080p</div>
                            <div class="quality-option" data-quality="720">720p</div>
                            <div class="quality-option" data-quality="480">480p</div>
                        </div>
                    </div>
                    <button id="fullscreen-exit-btn" class="fullscreen-control-btn">
                        <i data-lucide="minimize" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Fullscreen Shorts Player -->
    <div id="fullscreen-shorts" class="fullscreen-shorts">
        <div class="shorts-player-controls">
            <button id="back-from-shorts" class="back-btn">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
            </button>
        </div>
        <div class="shorts-player">
            <video id="fullscreen-shorts-video" loop>
                Your browser does not support the video tag.
            </video>
        </div>
        <div class="shorts-controls">
            <button class="shorts-control-btn" id="shorts-like-btn">
                <i data-lucide="heart" class="w-6 h-6"></i>
                <span id="shorts-likes-count">0</span>
            </button>
            <button class="shorts-control-btn" id="shorts-comment-btn">
                <i data-lucide="message-circle" class="w-6 h-6"></i>
                <span>0</span>
            </button>
            <button class="shorts-control-btn" id="shorts-share-btn">
                <i data-lucide="share" class="w-6 h-6"></i>
                <span>Share</span>
            </button>
            <button class="shorts-control-btn delete-btn" id="shorts-delete-btn">
                <i data-lucide="trash-2" class="w-6 h-6"></i>
                <span>Delete</span>
            </button>
        </div>
    </div>

    <!-- Desktop Sidebar -->
    <div id="desktop-sidebar" class="fixed top-0 left-0 h-full w-64 bg-dark-bg z-50 overflow-y-auto">
        <div class="p-4">
            <div class="flex items-center space-x-2 mb-6">
                <i data-lucide="play-circle" class="w-8 h-8 text-primary-red"></i>
                <h1 class="text-xl font-bold">NeoTube</h1>
            </div>
            
            <nav class="space-y-2">
                <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200 active-nav-item" data-section="home">
                    <i data-lucide="home" class="w-5 h-5"></i>
                    <span>Home</span>
                </a>
                <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200" data-section="shorts">
                    <i data-lucide="film" class="w-5 h-5"></i>
                    <span>Shorts</span>
                </a>
                <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200" data-section="subscriptions">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    <span>Subscriptions</span>
                </a>
                <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200" data-section="library">
                    <i data-lucide="library" class="w-5 h-5"></i>
                    <span>Library</span>
                </a>
                <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200" data-section="history">
                    <i data-lucide="history" class="w-5 h-5"></i>
                    <span>History</span>
                </a>
                <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200" data-section="playlists">
                    <i data-lucide="list-video" class="w-5 h-5"></i>
                    <span>Playlists</span>
                </a>
                <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200" data-section="liked">
                    <i data-lucide="thumbs-up" class="w-5 h-5"></i>
                    <span>Liked videos</span>
                </a>
            </nav>
            
            <div class="border-t border-gray-700 my-4 pt-4">
                <h3 class="font-semibold text-gray-400 text-sm mb-2">SUBSCRIPTIONS</h3>
                <div class="space-y-2">
                    <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200">
                        <div class="w-6 h-6 rounded-full bg-primary-red flex items-center justify-center text-xs">N</div>
                        <span>NeoTube Official</span>
                    </a>
                    <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200">
                        <div class="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center text-xs">S</div>
                        <span>Sci-Fi Channel</span>
                    </a>
                    <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200">
                        <div class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-xs">T</div>
                        <span>Tech Reviews</span>
                    </a>
                </div>
            </div>
            
            <div class="border-t border-gray-700 my-4 pt-4">
                <h3 class="font-semibold text-gray-400 text-sm mb-2">EXPLORE</h3>
                <div class="space-y-2">
                    <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200">
                        <i data-lucide="trending-up" class="w-5 h-5"></i>
                        <span>Trending</span>
                    </a>
                    <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200">
                        <i data-lucide="shopping-bag" class="w-5 h-5"></i>
                        <span>Shopping</span>
                    </a>
                    <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200">
                        <i data-lucide="music" class="w-5 h-5"></i>
                        <span>Music</span>
                    </a>
                    <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200">
                        <i data-lucide="award" class="w-5 h-5"></i>
                        <span>Sports</span>
                    </a>
                </div>
            </div>
            
            <div class="border-t border-gray-700 my-4 pt-4">
                <h3 class="font-semibold text-gray-400 text-sm mb-2">SETTINGS</h3>
                <div class="space-y-2">
                    <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200">
                        <i data-lucide="settings" class="w-5 h-5"></i>
                        <span>Settings</span>
                    </a>
                    <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200">
                        <i data-lucide="flag" class="w-5 h-5"></i>
                        <span>Report history</span>
                    </a>
                    <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200">
                        <i data-lucide="help-circle" class="w-5 h-5"></i>
                        <span>Help</span>
                    </a>
                    <a href="#" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-hover-bg transition duration-200">
                        <i data-lucide="message-square" class="w-5 h-5"></i>
                        <span>Send feedback</span>
                    </a>
                </div>
            </div>
            
            <div class="mt-6 pt-4 border-t border-gray-700 text-xs text-gray-400">
                <div class="flex flex-wrap gap-2 mb-2">
                    <a href="#" class="hover:text-white">About</a>
                    <a href="#" class="hover:text-white">Press</a>
                    <a href="#" class="hover:text-white">Copyright</a>
                    <a href="#" class="hover:text-white">Contact us</a>
                    <a href="#" class="hover:text-white">Creators</a>
                    <a href="#" class="hover:text-white">Advertise</a>
                    <a href="#" class="hover:text-white">Developers</a>
                </div>
                <div class="flex flex-wrap gap-2 mb-2">
                    <a href="#" class="hover:text-white">Terms</a>
                    <a href="#" class="hover:text-white">Privacy</a>
                    <a href="#" class="hover:text-white">Policy & Safety</a>
                    <a href="#" class="hover:text-white">How YouTube works</a>
                </div>
                <div class="mt-2">
                    <span>&copy; 2023 NeoTube</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="min-h-screen pb-16 md:pb-0">
        <!-- Header -->
        <header class="sticky top-0 z-40 bg-dark-bg border-b border-gray-700">
            <div class="flex items-center justify-between p-4">
                <!-- Left Section -->
                <div class="flex items-center space-x-4">
                    <button id="menu-toggle" class="md:hidden text-white">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    <div class="flex items-center space-x-2">
                        <i data-lucide="play-circle" class="w-8 h-8 text-primary-red"></i>
                        <h1 class="text-xl font-bold">NeoTube</h1>
                    </div>
                </div>
                
                <!-- Center Section - Search Bar -->
                <div class="hidden md:flex flex-1 max-w-2xl mx-4">
                    <div class="flex w-full">
                        <input type="text" id="search-input" placeholder="Search" 
                               class="w-full px-4 py-2 bg-card-bg border border-gray-600 rounded-l-full focus:ring-1 focus:ring-primary-red focus:border-primary-red outline-none transition duration-200">
                        <button id="search-btn" class="px-6 bg-card-bg border border-l-0 border-gray-600 rounded-r-full hover:bg-hover-bg transition duration-200">
                            <i data-lucide="search" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Right Section -->
                <div class="flex items-center space-x-4">
                    <button id="search-icon" class="md:hidden text-white">
                        <i data-lucide="search" class="w-6 h-6"></i>
                    </button>
                    <button id="upload-btn" class="bg-primary-red hover:bg-red-700 text-white px-4 py-2 rounded-full flex items-center space-x-2 transition duration-200">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                        <span class="hidden md:inline">Upload</span>
                    </button>
                    <div id="user-profile" class="hidden">
                        <div class="w-8 h-8 rounded-full bg-primary-red flex items-center justify-center cursor-pointer" id="user-avatar">
                            <span class="text-white font-semibold text-sm" id="avatar-text">U</span>
                        </div>
                    </div>
                    <button id="sign-in-btn" class="bg-primary-red hover:bg-red-700 text-white px-4 py-2 rounded-full flex items-center space-x-2 transition duration-200">
                        <i data-lucide="log-in" class="w-5 h-5"></i>
                        <span>Sign In</span>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Search Bar -->
            <div id="mobile-search" class="md:hidden p-4 border-t border-gray-700 hidden">
                <div class="flex">
                    <input type="text" placeholder="Search" 
                           class="w-full px-4 py-2 bg-card-bg border border-gray-600 rounded-l-full focus:ring-1 focus:ring-primary-red focus:border-primary-red outline-none transition duration-200">
                    <button class="px-6 bg-card-bg border border-l-0 border-gray-600 rounded-r-full hover:bg-hover-bg transition duration-200">
                        <i data-lucide="search" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content Sections -->
        <div class="container mx-auto px-4 py-6">
            <!-- Home Section -->
            <section id="home-section" class="content-section active">
                <!-- Categories -->
                <div class="flex overflow-x-auto space-x-2 pb-4 mb-6 hide-scrollbar">
                    <button class="category-btn px-4 py-2 bg-card-bg rounded-full whitespace-nowrap active">All</button>
                    <button class="category-btn px-4 py-2 bg-card-bg rounded-full whitespace-nowrap">Sci-Fi</button>
                    <button class="category-btn px-4 py-2 bg-card-bg rounded-full whitespace-nowrap">Fantasy</button>
                    <button class="category-btn px-4 py-2 bg-card-bg rounded-full whitespace-nowrap">Comedy</button>
                    <button class="category-btn px-4 py-2 bg-card-bg rounded-full whitespace-nowrap">Drama</button>
                    <button class="category-btn px-4 py-2 bg-card-bg rounded-full whitespace-nowrap">Movie</button>
                    <button class="category-btn px-4 py-2 bg-card-bg rounded-full whitespace-nowrap">Romance</button>
                    <button class="category-btn px-4 py-2 bg-card-bg rounded-full whitespace-nowrap">Action</button>
                    <button class="category-btn px-4 py-2 bg-card-bg rounded-full whitespace-nowrap">Thriller</button>
                </div>
                
                <!-- Videos Grid -->
                <div id="videos-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    <!-- Videos will be dynamically loaded here -->
                </div>
                
                <!-- No Videos Message -->
                <div id="no-videos-message" class="text-center py-12 hidden">
                    <i data-lucide="video-off" class="w-16 h-16 mx-auto text-gray-500 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">No videos available</h3>
                    <p class="text-gray-400 mb-6">Upload your first video to get started!</p>
                    <button id="upload-first-video" class="bg-primary-red hover:bg-red-700 text-white px-6 py-3 rounded-full transition duration-200">
                        Upload Video
                    </button>
                </div>
            </section>
            
            <!-- Shorts Section -->
            <section id="shorts-section" class="content-section">
                <h2 class="text-2xl font-bold mb-6">Shorts</h2>
                
                <div id="shorts-container" class="shorts-grid">
                    <!-- Shorts will be dynamically loaded here -->
                </div>
                
                <!-- No Shorts Message -->
                <div id="no-shorts-message" class="text-center py-12 hidden">
                    <i data-lucide="film" class="w-16 h-16 mx-auto text-gray-500 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">No shorts available</h3>
                    <p class="text-gray-400 mb-6">Upload your first short video to get started!</p>
                    <button id="upload-first-short" class="bg-primary-red hover:bg-red-700 text-white px-6 py-3 rounded-full transition duration-200">
                        Upload Short
                    </button>
                </div>
            </section>
            
            <!-- Subscriptions Section -->
            <section id="subscriptions-section" class="content-section">
                <h2 class="text-2xl font-bold mb-6">Subscriptions</h2>
                <div class="bg-card-bg rounded-lg p-6 text-center">
                    <i data-lucide="users" class="w-16 h-16 mx-auto text-gray-500 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">No subscriptions yet</h3>
                    <p class="text-gray-400">Subscribe to channels to see their latest videos here</p>
                </div>
            </section>
            
            <!-- Library Section -->
            <section id="library-section" class="content-section">
                <h2 class="text-2xl font-bold mb-6">Library</h2>
                <div class="bg-card-bg rounded-lg p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="p-4 rounded-lg hover:bg-hover-bg transition duration-200 cursor-pointer">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 rounded-full bg-primary-red flex items-center justify-center">
                                    <i data-lucide="history" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">History</h3>
                                    <p class="text-gray-400 text-sm">View your watch history</p>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 rounded-lg hover:bg-hover-bg transition duration-200 cursor-pointer">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 rounded-full bg-blue-500 flex items-center justify-center">
                                    <i data-lucide="play-square" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">Your videos</h3>
                                    <p class="text-gray-400 text-sm">Manage your uploaded videos</p>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 rounded-lg hover:bg-hover-bg transition duration-200 cursor-pointer">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 rounded-full bg-green-500 flex items-center justify-center">
                                    <i data-lucide="thumbs-up" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">Liked videos</h3>
                                    <p class="text-gray-400 text-sm">Videos you've liked</p>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 rounded-lg hover:bg-hover-bg transition duration-200 cursor-pointer">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 rounded-full bg-purple-500 flex items-center justify-center">
                                    <i data-lucide="list-video" class="w-6 h-6"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">Playlists</h3>
                                    <p class="text-gray-400 text-sm">Your saved playlists</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- History Section -->
            <section id="history-section" class="content-section">
                <h2 class="text-2xl font-bold mb-6">Watch History</h2>
                <div id="history-container" class="space-y-4">
                    <!-- History items will be dynamically loaded here -->
                </div>
                <div id="no-history-message" class="text-center py-12 hidden">
                    <i data-lucide="history" class="w-16 h-16 mx-auto text-gray-500 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">No watch history</h3>
                    <p class="text-gray-400">Videos you watch will appear here</p>
                </div>
            </section>
            
            <!-- Playlists Section -->
            <section id="playlists-section" class="content-section">
                <h2 class="text-2xl font-bold mb-6">Playlists</h2>
                <div class="bg-card-bg rounded-lg p-6 text-center">
                    <i data-lucide="list-video" class="w-16 h-16 mx-auto text-gray-500 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">No playlists yet</h3>
                    <p class="text-gray-400">Create playlists to organize your favorite videos</p>
                </div>
            </section>
            
            <!-- Liked Videos Section -->
            <section id="liked-section" class="content-section">
                <h2 class="text-2xl font-bold mb-6">Liked Videos</h2>
                <div class="bg-card-bg rounded-lg p-6 text-center">
                    <i data-lucide="thumbs-up" class="w-16 h-16 mx-auto text-gray-500 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">No liked videos yet</h3>
                    <p class="text-gray-400">Videos you like will appear here</p>
                </div>
            </section>
        </div>
    </main>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <div class="flex justify-around py-3">
            <a href="#" class="flex flex-col items-center text-primary-red" data-section="home">
                <i data-lucide="home" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Home</span>
            </a>
            <a href="#" class="flex flex-col items-center text-gray-400" data-section="shorts">
                <i data-lucide="film" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Shorts</span>
            </a>
            <a href="#" class="flex flex-col items-center text-gray-400" data-section="subscriptions">
                <i data-lucide="users" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Subscriptions</span>
            </a>
            <a href="#" class="flex flex-col items-center text-gray-400" data-section="library">
                <i data-lucide="library" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Library</span>
            </a>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        // Firebase configuration (already initialized in the head)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_BUCKET.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Global variables
        let currentUser = null;
        let selectedCategories = [];
        let selectedShortsCategories = [];
        let currentVideo = null;
        let currentShorts = null;
        let videos = [];
        let shorts = [];
        let watchHistory = [];
        let likedVideos = [];

        // DOM Elements
        const authModal = document.getElementById('auth-modal');
        const usernameModal = document.getElementById('username-modal');
        const uploadModal = document.getElementById('upload-modal');
        const videoPlayerModal = document.getElementById('video-player-modal');
        const fullscreenPlayer = document.getElementById('fullscreen-player');
        const fullscreenShorts = document.getElementById('fullscreen-shorts');
        
        // Auth elements
        const googleAuthBtn = document.getElementById('google-auth-btn');
        const emailAuthBtn = document.getElementById('email-auth-btn');
        const signInBtn = document.getElementById('sign-in-btn');
        const userProfile = document.getElementById('user-profile');
        const userAvatar = document.getElementById('user-avatar');
        const avatarText = document.getElementById('avatar-text');
        const usernameInput = document.getElementById('username-input');
        const saveUsernameBtn = document.getElementById('save-username');
        
        // Upload elements
        const uploadBtn = document.getElementById('upload-btn');
        const closeUploadModal = document.getElementById('close-upload-modal');
        const cancelUpload = document.getElementById('cancel-upload');
        const uploadForm = document.getElementById('upload-form');
        const uploadVideoTab = document.getElementById('upload-video-tab');
        const uploadShortsTab = document.getElementById('upload-shorts-tab');
        const uploadShortsForm = document.getElementById('upload-shorts-form');
        const cancelShortsUpload = document.getElementById('cancel-shorts-upload');
        const videoFile = document.getElementById('video-file');
        const fileName = document.getElementById('file-name');
        const shortsFile = document.getElementById('shorts-file');
        const shortsFileName = document.getElementById('shorts-file-name');
        const thumbnailPreview = document.getElementById('thumbnail-preview');
        const shortsThumbnailPreview = document.getElementById('shorts-thumbnail-preview');
        const uploadProgress = document.getElementById('upload-progress');
        const progressBarFill = document.getElementById('progress-bar-fill');
        const uploadStatus = document.getElementById('upload-status');
        const shortsUploadProgress = document.getElementById('shorts-upload-progress');
        const shortsProgressBarFill = document.getElementById('shorts-progress-bar-fill');
        const shortsUploadStatus = document.getElementById('shorts-upload-status');
        const videoTitle = document.getElementById('video-title');
        const videoDescription = document.getElementById('video-description');
        const charCount = document.getElementById('char-count');
        const shortsTitle = document.getElementById('shorts-title');
        const shortsDescription = document.getElementById('shorts-description');
        const shortsCharCount = document.getElementById('shorts-char-count');
        const selectedCategoriesContainer = document.getElementById('selected-categories');
        const categorySelectBtns = document.querySelectorAll('.category-select-btn');
        
        // Player elements
        const closePlayerModal = document.getElementById('close-player-modal');
        const playerVideoTitle = document.getElementById('player-video-title');
        const playerVideoDescription = document.getElementById('player-video-description');
        const playerVideoCategories = document.getElementById('player-video-categories');
        const playerLikeBtn = document.getElementById('player-like-btn');
        const playerDislikeBtn = document.getElementById('player-dislike-btn');
        const playerLikesCount = document.getElementById('player-likes-count');
        const playerDislikesCount = document.getElementById('player-dislikes-count');
        const playerShareBtn = document.getElementById('player-share-btn');
        const playerDeleteBtn = document.getElementById('player-delete-btn');
        const fullscreenVideo = document.getElementById('fullscreen-video');
        const fullscreenVideoPlayer = document.getElementById('fullscreen-video-player');
        const fullscreenShortsVideo = document.getElementById('fullscreen-shorts-video');
        
        // Player control elements
        const playPauseOverlay = document.getElementById('play-pause-overlay');
        const playerPlayBtn = document.getElementById('player-play-btn');
        const playerMuteBtn = document.getElementById('player-mute-btn');
        const volumeSlider = document.getElementById('volume-slider');
        const volumeLevel = document.getElementById('volume-level');
        const currentTime = document.getElementById('current-time');
        const durationTime = document.getElementById('duration-time');
        const progressContainer = document.getElementById('progress-container');
        const progressBarPlayer = document.getElementById('progress-bar-player');
        const progressHover = document.getElementById('progress-hover');
        const playerQualityBtn = document.getElementById('player-quality-btn');
        const qualityMenu = document.getElementById('quality-menu');
        const playerFullscreenBtn = document.getElementById('player-fullscreen-btn');
        
        // Fullscreen player controls
        const fullscreenPlayBtn = document.getElementById('fullscreen-play-btn');
        const fullscreenMuteBtn = document.getElementById('fullscreen-mute-btn');
        const fullscreenVolumeSlider = document.getElementById('fullscreen-volume-slider');
        const fullscreenVolumeLevel = document.getElementById('fullscreen-volume-level');
        const fullscreenCurrentTime = document.getElementById('fullscreen-current-time');
        const fullscreenDurationTime = document.getElementById('fullscreen-duration-time');
        const fullscreenProgressContainer = document.getElementById('fullscreen-progress-container');
        const fullscreenProgressBar = document.getElementById('fullscreen-progress-bar');
        const fullscreenProgressHover = document.getElementById('fullscreen-progress-hover');
        const fullscreenQualityBtn = document.getElementById('fullscreen-quality-btn');
        const fullscreenQualityMenu = document.getElementById('fullscreen-quality-menu');
        const fullscreenExitBtn = document.getElementById('fullscreen-exit-btn');
        
        // Shorts player controls
        const backFromShorts = document.getElementById('back-from-shorts');
        const shortsLikeBtn = document.getElementById('shorts-like-btn');
        const shortsLikesCount = document.getElementById('shorts-likes-count');
        const shortsCommentBtn = document.getElementById('shorts-comment-btn');
        const shortsShareBtn = document.getElementById('shorts-share-btn');
        const shortsDeleteBtn = document.getElementById('shorts-delete-btn');
        
        // Navigation elements
        const menuToggle = document.getElementById('menu-toggle');
        const searchIcon = document.getElementById('search-icon');
        const mobileSearch = document.getElementById('mobile-search');
        const navLinks = document.querySelectorAll('nav a, .mobile-menu a');
        const contentSections = document.querySelectorAll('.content-section');
        const categoryBtns = document.querySelectorAll('.category-btn');
        
        // Content containers
        const videosContainer = document.getElementById('videos-container');
        const noVideosMessage = document.getElementById('no-videos-message');
        const uploadFirstVideo = document.getElementById('upload-first-video');
        const shortsContainer = document.getElementById('shorts-container');
        const noShortsMessage = document.getElementById('no-shorts-message');
        const uploadFirstShort = document.getElementById('upload-first-short');
        const historyContainer = document.getElementById('history-container');
        const noHistoryMessage = document.getElementById('no-history-message');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage
            loadData();
            
            // Check if user is logged in
            checkAuthState();
            
            // Set up event listeners
            setupEventListeners();
            
            // Render initial content
            renderVideos();
            renderShorts();
            renderHistory();
            
            // Show auth modal if not logged in
            if (!currentUser) {
                setTimeout(() => {
                    authModal.style.display = 'flex';
                }, 1000);
            }
        });

        // Load data from localStorage
        function loadData() {
            // Load user data
            const userData = localStorage.getItem('neotube_user');
            if (userData) {
                currentUser = JSON.parse(userData);
            }
            
            // Load videos
            const videosData = localStorage.getItem('neotube_videos');
            if (videosData) {
                videos = JSON.parse(videosData);
            } else {
                // Add demo videos if none exist
                addDemoVideos();
            }
            
            // Load shorts
            const shortsData = localStorage.getItem('neotube_shorts');
            if (shortsData) {
                shorts = JSON.parse(shortsData);
            } else {
                // Add demo shorts if none exist
                addDemoShorts();
            }
            
            // Load watch history
            const historyData = localStorage.getItem('neotube_history');
            if (historyData) {
                watchHistory = JSON.parse(historyData);
            }
            
            // Load liked videos
            const likedData = localStorage.getItem('neotube_liked');
            if (likedData) {
                likedVideos = JSON.parse(likedData);
            }
        }

        // Save data to localStorage
        function saveData() {
            if (currentUser) {
                localStorage.setItem('neotube_user', JSON.stringify(currentUser));
            }
            localStorage.setItem('neotube_videos', JSON.stringify(videos));
            localStorage.setItem('neotube_shorts', JSON.stringify(shorts));
            localStorage.setItem('neotube_history', JSON.stringify(watchHistory));
            localStorage.setItem('neotube_liked', JSON.stringify(likedVideos));
        }

        // Add demo videos
        function addDemoVideos() {
            videos = [
                {
                    id: 'demo1',
                    title: 'Introduction to NeoTube',
                    description: 'Welcome to NeoTube! This is a demo video showcasing the features of our platform.',
                    url: 'https://storage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',
                    thumbnail: 'https://storage.googleapis.com/gtv-videos-bucket/sample/images/BigBuckBunny.jpg',
                    categories: ['scifi', 'movie'],
                    likes: 42,
                    dislikes: 3,
                    views: 150,
                    uploadDate: new Date().toISOString(),
                    uploader: 'NeoTube Official',
                    uploaderId: 'neotube'
                },
                {
                    id: 'demo2',
                    title: 'Exploring the Future of Technology',
                    description: 'A fascinating look at how technology is evolving and what we can expect in the coming years.',
                    url: 'https://storage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4',
                    thumbnail: 'https://storage.googleapis.com/gtv-videos-bucket/sample/images/ElephantsDream.jpg',
                    categories: ['scifi', 'tech'],
                    likes: 28,
                    dislikes: 1,
                    views: 98,
                    uploadDate: new Date(Date.now() - 86400000).toISOString(),
                    uploader: 'Tech Reviews',
                    uploaderId: 'techreviews'
                },
                {
                    id: 'demo3',
                    title: 'The Art of Storytelling',
                    description: 'Learn how to craft compelling narratives that captivate your audience.',
                    url: 'https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4',
                    thumbnail: 'https://storage.googleapis.com/gtv-videos-bucket/sample/images/ForBiggerBlazes.jpg',
                    categories: ['drama', 'comedy'],
                    likes: 15,
                    dislikes: 0,
                    views: 67,
                    uploadDate: new Date(Date.now() - 172800000).toISOString(),
                    uploader: 'Creative Minds',
                    uploaderId: 'creativeminds'
                },
                {
                    id: 'demo4',
                    title: 'Amazing Nature Documentary',
                    description: 'Experience the beauty and wonder of our natural world in this breathtaking documentary.',
                    url: 'https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4',
                    thumbnail: 'https://storage.googleapis.com/gtv-videos-bucket/sample/images/ForBiggerEscapes.jpg',
                    categories: ['nature', 'documentary'],
                    likes: 37,
                    dislikes: 2,
                    views: 124,
                    uploadDate: new Date(Date.now() - 259200000).toISOString(),
                    uploader: 'Nature Channel',
                    uploaderId: 'naturechannel'
                }
            ];
            saveData();
        }

        // Add demo shorts
        function addDemoShorts() {
            shorts = [
                {
                    id: 'short1',
                    title: 'Quick Tech Tip',
                    description: 'A quick tip to improve your productivity',
                    url: 'https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4',
                    thumbnail: 'https://storage.googleapis.com/gtv-videos-bucket/sample/images/ForBiggerFun.jpg',
                    categories: ['tech', 'tips'],
                    likes: 15,
                    views: 89,
                    uploadDate: new Date().toISOString(),
                    uploader: 'Tech Tips',
                    uploaderId: 'techtips'
                },
                {
                    id: 'short2',
                    title: 'Funny Cat Moment',
                    description: 'Watch this hilarious cat fail',
                    url: 'https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4',
                    thumbnail: 'https://storage.googleapis.com/gtv-videos-bucket/sample/images/ForBiggerJoyrides.jpg',
                    categories: ['comedy', 'animals'],
                    likes: 42,
                    views: 156,
                    uploadDate: new Date(Date.now() - 43200000).toISOString(),
                    uploader: 'Funny Clips',
                    uploaderId: 'funnyclips'
                },
                {
                    id: 'short3',
                    title: 'Amazing Dance Move',
                    description: 'Check out this incredible dance routine',
                    url: 'https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4',
                    thumbnail: 'https://storage.googleapis.com/gtv-videos-bucket/sample/images/ForBiggerMeltdowns.jpg',
                    categories: ['dance', 'entertainment'],
                    likes: 28,
                    views: 112,
                    uploadDate: new Date(Date.now() - 86400000).toISOString(),
                    uploader: 'Dance Studio',
                    uploaderId: 'dancestudio'
                }
            ];
            saveData();
        }

        // Check authentication state
        function checkAuthState() {
            if (currentUser) {
                // User is logged in
                signInBtn.classList.add('hidden');
                userProfile.classList.remove('hidden');
                avatarText.textContent = currentUser.username ? currentUser.username.charAt(0).toUpperCase() : 'U';
            } else {
                // User is not logged in
                signInBtn.classList.remove('hidden');
                userProfile.classList.add('hidden');
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Auth events
            googleAuthBtn.addEventListener('click', handleGoogleAuth);
            emailAuthBtn.addEventListener('click', handleEmailAuth);
            signInBtn.addEventListener('click', () => authModal.style.display = 'flex');
            saveUsernameBtn.addEventListener('click', saveUsername);
            
            // Upload events
            uploadBtn.addEventListener('click', openUploadModal);
            closeUploadModal.addEventListener('click', closeUploadModalFunc);
            cancelUpload.addEventListener('click', closeUploadModalFunc);
            uploadForm.addEventListener('submit', handleVideoUpload);
            uploadVideoTab.addEventListener('click', () => switchUploadTab('video'));
            uploadShortsTab.addEventListener('click', () => switchUploadTab('shorts'));
            uploadShortsForm.addEventListener('submit', handleShortsUpload);
            cancelShortsUpload.addEventListener('click', closeUploadModalFunc);
            
            // File input events
            videoFile.addEventListener('change', handleFileSelect);
            shortsFile.addEventListener('change', handleShortsFileSelect);
            
            // Description character count
            videoDescription.addEventListener('input', updateCharCount);
            shortsDescription.addEventListener('input', updateShortsCharCount);
            
            // Category selection
            categorySelectBtns.forEach(btn => {
                btn.addEventListener('click', toggleCategory);
            });
            
            // Player events
            closePlayerModal.addEventListener('click', closeVideoPlayer);
            playerLikeBtn.addEventListener('click', likeVideo);
            playerDislikeBtn.addEventListener('click', dislikeVideo);
            playerShareBtn.addEventListener('click', shareVideo);
            playerDeleteBtn.addEventListener('click', deleteVideo);
            
            // Player control events
            playPauseOverlay.addEventListener('click', togglePlayPause);
            playerPlayBtn.addEventListener('click', togglePlayPause);
            playerMuteBtn.addEventListener('click', toggleMute);
            volumeSlider.addEventListener('click', setVolume);
            progressContainer.addEventListener('click', setProgress);
            progressContainer.addEventListener('mousemove', updateProgressHover);
            progressContainer.addEventListener('mouseleave', () => progressHover.style.width = '0%');
            playerQualityBtn.addEventListener('click', toggleQualityMenu);
            playerFullscreenBtn.addEventListener('click', enterFullscreen);
            
            // Fullscreen player events
            fullscreenPlayBtn.addEventListener('click', toggleFullscreenPlayPause);
            fullscreenMuteBtn.addEventListener('click', toggleFullscreenMute);
            fullscreenVolumeSlider.addEventListener('click', setFullscreenVolume);
            fullscreenProgressContainer.addEventListener('click', setFullscreenProgress);
            fullscreenProgressContainer.addEventListener('mousemove', updateFullscreenProgressHover);
            fullscreenProgressContainer.addEventListener('mouseleave', () => fullscreenProgressHover.style.width = '0%');
            fullscreenQualityBtn.addEventListener('click', toggleFullscreenQualityMenu);
            fullscreenExitBtn.addEventListener('click', exitFullscreen);
            
            // Shorts events
            backFromShorts.addEventListener('click', closeFullscreenShorts);
            shortsLikeBtn.addEventListener('click', likeShorts);
            shortsShareBtn.addEventListener('click', shareShorts);
            shortsDeleteBtn.addEventListener('click', deleteShorts);
            
            // Navigation events
            menuToggle.addEventListener('click', toggleMobileMenu);
            searchIcon.addEventListener('click', toggleMobileSearch);
            navLinks.forEach(link => {
                link.addEventListener('click', handleNavClick);
            });
            categoryBtns.forEach(btn => {
                btn.addEventListener('click', handleCategoryFilter);
            });
            
            // First upload buttons
            uploadFirstVideo.addEventListener('click', openUploadModal);
            uploadFirstShort.addEventListener('click', () => {
                openUploadModal();
                switchUploadTab('shorts');
            });
            
            // Video events (delegated)
            videosContainer.addEventListener('click', handleVideoClick);
            shortsContainer.addEventListener('click', handleShortsClick);
            historyContainer.addEventListener('click', handleHistoryClick);
            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === authModal) authModal.style.display = 'none';
                if (e.target === usernameModal) usernameModal.style.display = 'none';
                if (e.target === uploadModal) closeUploadModalFunc();
                if (e.target === videoPlayerModal) closeVideoPlayer();
                if (e.target === fullscreenPlayer) exitFullscreen();
                if (e.target === fullscreenShorts) closeFullscreenShorts();
            });
            
            // Video time update events
            fullscreenVideo.addEventListener('timeupdate', updateVideoTime);
            fullscreenVideoPlayer.addEventListener('timeupdate', updateFullscreenVideoTime);
            fullscreenShortsVideo.addEventListener('timeupdate', updateShortsVideoTime);
            
            // Video ended events
            fullscreenVideo.addEventListener('ended', videoEnded);
            fullscreenVideoPlayer.addEventListener('ended', fullscreenVideoEnded);
            fullscreenShortsVideo.addEventListener('ended', shortsVideoEnded);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
        }

        // Authentication handlers
        async function handleGoogleAuth() {
            try {
                const result = await window.firebase.signInWithPopup(window.firebase.auth, window.firebase.provider);
                const user = result.user;
                
                // Check if user exists in our system
                let userData = localStorage.getItem('neotube_user');
                if (!userData) {
                    // New user, show username modal
                    currentUser = {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName,
                        photoURL: user.photoURL
                    };
                    usernameModal.style.display = 'flex';
                    authModal.style.display = 'none';
                } else {
                    // Existing user
                    currentUser = JSON.parse(userData);
                    checkAuthState();
                    authModal.style.display = 'none';
                    saveData();
                }
            } catch (error) {
                console.error('Google auth error:', error);
                alert('Authentication failed. Please try again.');
            }
        }

        function handleEmailAuth() {
            alert('Email authentication will be implemented in a future version.');
        }

        function saveUsername() {
            const username = usernameInput.value.trim();
            if (username) {
                currentUser.username = username;
                usernameModal.style.display = 'none';
                checkAuthState();
                saveData();
            } else {
                alert('Please enter a username');
            }
        }

        // Upload handlers
        function openUploadModal() {
            if (!currentUser) {
                authModal.style.display = 'flex';
                return;
            }
            uploadModal.style.display = 'flex';
            resetUploadForm();
        }

        function closeUploadModalFunc() {
            uploadModal.style.display = 'none';
            resetUploadForm();
        }

        function switchUploadTab(type) {
            const videoForm = document.getElementById('upload-form');
            const shortsForm = document.getElementById('upload-shorts-form');
            const videoTab = document.getElementById('upload-video-tab');
            const shortsTab = document.getElementById('upload-shorts-tab');
            
            if (type === 'video') {
                videoForm.classList.remove('hidden');
                shortsForm.classList.add('hidden');
                videoTab.classList.add('border-b-2', 'border-primary-red', 'text-primary-red');
                videoTab.classList.remove('text-gray-400');
                shortsTab.classList.remove('border-b-2', 'border-primary-red', 'text-primary-red');
                shortsTab.classList.add('text-gray-400');
            } else {
                videoForm.classList.add('hidden');
                shortsForm.classList.remove('hidden');
                shortsTab.classList.add('border-b-2', 'border-primary-red', 'text-primary-red');
                shortsTab.classList.remove('text-gray-400');
                videoTab.classList.remove('border-b-2', 'border-primary-red', 'text-primary-red');
                videoTab.classList.add('text-gray-400');
            }
        }

        function resetUploadForm() {
            uploadForm.reset();
            uploadShortsForm.reset();
            fileName.textContent = 'Choose video file';
            shortsFileName.textContent = 'Choose shorts video';
            thumbnailPreview.style.display = 'none';
            shortsThumbnailPreview.style.display = 'none';
            uploadProgress.classList.add('hidden');
            shortsUploadProgress.classList.add('hidden');
            selectedCategories = [];
            updateSelectedCategories();
            charCount.textContent = '0';
            shortsCharCount.textContent = '0';
            switchUploadTab('video');
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                fileName.textContent = file.name;
                
                // Validate file type
                const validTypes = ['video/mp4', 'video/webm', 'video/quicktime', 'video/x-matroska', 'video/x-msvideo', 'video/3gpp', 'video/ogg'];
                if (!validTypes.includes(file.type)) {
                    alert('Please select a valid video file (MP4, WebM, MOV, MKV, AVI, 3GP, or OGG)');
                    e.target.value = '';
                    fileName.textContent = 'Choose video file';
                    return;
                }
                
                // Validate file size (100MB max)
                if (file.size > 100 * 1024 * 1024) {
                    alert('File size must be less than 100MB');
                    e.target.value = '';
                    fileName.textContent = 'Choose video file';
                    return;
                }
                
                // Generate thumbnail preview
                generateThumbnail(file, thumbnailPreview);
            }
        }

        function handleShortsFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                shortsFileName.textContent = file.name;
                
                // Validate file type
                const validTypes = ['video/mp4', 'video/webm', 'video/quicktime', 'video/x-matroska', 'video/x-msvideo', 'video/3gpp', 'video/ogg'];
                if (!validTypes.includes(file.type)) {
                    alert('Please select a valid video file (MP4, WebM, MOV, MKV, AVI, 3GP, or OGG)');
                    e.target.value = '';
                    shortsFileName.textContent = 'Choose shorts video';
                    return;
                }
                
                // Validate file size (50MB max for shorts)
                if (file.size > 50 * 1024 * 1024) {
                    alert('Shorts file size must be less than 50MB');
                    e.target.value = '';
                    shortsFileName.textContent = 'Choose shorts video';
                    return;
                }
                
                // Generate thumbnail preview
                generateThumbnail(file, shortsThumbnailPreview);
            }
        }

        function generateThumbnail(file, previewElement) {
            const video = document.createElement('video');
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            video.src = URL.createObjectURL(file);
            video.addEventListener('loadeddata', function() {
                video.currentTime = 1; // Seek to 1 second
            });
            
            video.addEventListener('seeked', function() {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                previewElement.src = canvas.toDataURL();
                previewElement.style.display = 'block';
                
                URL.revokeObjectURL(video.src);
            });
        }

        function updateCharCount() {
            charCount.textContent = videoDescription.value.length;
        }

        function updateShortsCharCount() {
            shortsCharCount.textContent = shortsDescription.value.length;
        }

        function toggleCategory(e) {
            const category = e.target.dataset.category;
            const index = selectedCategories.indexOf(category);
            
            if (index === -1) {
                if (selectedCategories.length < 4) {
                    selectedCategories.push(category);
                    e.target.classList.add('selected');
                } else {
                    alert('You can select up to 4 categories only');
                }
            } else {
                selectedCategories.splice(index, 1);
                e.target.classList.remove('selected');
            }
            
            updateSelectedCategories();
        }

        function updateSelectedCategories() {
            selectedCategoriesContainer.innerHTML = '';
            selectedCategories.forEach(category => {
                const tag = document.createElement('span');
                tag.className = 'category-tag';
                tag.innerHTML = `
                    ${category}
                    <span class="category-tag-remove" data-category="${category}">
                        <i data-lucide="x" class="w-3 h-3"></i>
                    </span>
                `;
                selectedCategoriesContainer.appendChild(tag);
            });
            
            // Add event listeners to remove buttons
            const removeButtons = selectedCategoriesContainer.querySelectorAll('.category-tag-remove');
            removeButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const category = btn.dataset.category;
                    const index = selectedCategories.indexOf(category);
                    if (index !== -1) {
                        selectedCategories.splice(index, 1);
                        updateSelectedCategories();
                        
                        // Update the category button state
                        const categoryBtn = document.querySelector(`.category-select-btn[data-category="${category}"]`);
                        if (categoryBtn) {
                            categoryBtn.classList.remove('selected');
                        }
                    }
                });
            });
            
            lucide.createIcons();
        }

        async function handleVideoUpload(e) {
            e.preventDefault();
            
            if (!currentUser) {
                alert('Please sign in to upload videos');
                return;
            }
            
            const title = videoTitle.value.trim();
            const description = videoDescription.value.trim();
            const url = videoUrl.value.trim();
            const file = videoFile.files[0];
            
            if (!title || !description) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (!url && !file) {
                alert('Please provide either a video URL or upload a file');
                return;
            }
            
            if (selectedCategories.length === 0) {
                alert('Please select at least one category');
                return;
            }
            
            let videoUrlToUse = url;
            
            // If file is uploaded, upload to Firebase Storage
            if (file) {
                try {
                    videoUrlToUse = await uploadToFirebase(file, 'videos', uploadProgress, progressBarFill, uploadStatus);
                } catch (error) {
                    console.error('Upload failed:', error);
                    alert('Upload failed. Please try again.');
                    return;
                }
            }
            
            // Create video object
            const video = {
                id: generateId(),
                title,
                description,
                url: videoUrlToUse,
                thumbnail: thumbnailPreview.style.display !== 'none' ? thumbnailPreview.src : '',
                categories: [...selectedCategories],
                likes: 0,
                dislikes: 0,
                views: 0,
                uploadDate: new Date().toISOString(),
                uploader: currentUser.username || currentUser.displayName || 'User',
                uploaderId: currentUser.uid
            };
            
            // Add to videos array
            videos.unshift(video);
            saveData();
            renderVideos();
            
            // Close modal and reset form
            closeUploadModalFunc();
            
            // Show success message
            alert('Video uploaded successfully!');
        }

        async function handleShortsUpload(e) {
            e.preventDefault();
            
            if (!currentUser) {
                alert('Please sign in to upload shorts');
                return;
            }
            
            const title = shortsTitle.value.trim();
            const description = shortsDescription.value.trim();
            const url = shortsUrl.value.trim();
            const file = shortsFile.files[0];
            
            if (!title || !description) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (!url && !file) {
                alert('Please provide either a shorts URL or upload a file');
                return;
            }
            
            let shortsUrlToUse = url;
            
            // If file is uploaded, upload to Firebase Storage
            if (file) {
                try {
                    shortsUrlToUse = await uploadToFirebase(file, 'shorts', shortsUploadProgress, shortsProgressBarFill, shortsUploadStatus);
                } catch (error) {
                    console.error('Upload failed:', error);
                    alert('Upload failed. Please try again.');
                    return;
                }
            }
            
            // Create shorts object
            const short = {
                id: generateId(),
                title,
                description,
                url: shortsUrlToUse,
                thumbnail: shortsThumbnailPreview.style.display !== 'none' ? shortsThumbnailPreview.src : '',
                categories: ['shorts'],
                likes: 0,
                views: 0,
                uploadDate: new Date().toISOString(),
                uploader: currentUser.username || currentUser.displayName || 'User',
                uploaderId: currentUser.uid
            };
            
            // Add to shorts array
            shorts.unshift(short);
            saveData();
            renderShorts();
            
            // Close modal and reset form
            closeUploadModalFunc();
            
            // Show success message
            alert('Shorts uploaded successfully!');
        }

        async function uploadToFirebase(file, folder, progressElement, progressBar, statusElement) {
            return new Promise((resolve, reject) => {
                // Show progress bar
                progressElement.classList.remove('hidden');
                
                // Create a storage reference
                const storageRef = window.firebase.ref(window.firebase.storage, `${folder}/${file.name}_${Date.now()}`);
                
                // Upload file
                const uploadTask = window.firebase.uploadBytesResumable(storageRef, file);
                
                // Listen for state changes, errors, and completion
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // Get upload progress
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        progressBar.style.width = progress + '%';
                        statusElement.textContent = `Uploading: ${Math.round(progress)}%`;
                    },
                    (error) => {
                        // Handle unsuccessful uploads
                        console.error('Upload error:', error);
                        reject(error);
                    },
                    async () => {
                        // Handle successful uploads
                        try {
                            // Get download URL
                            const downloadURL = await window.firebase.getDownloadURL(uploadTask.snapshot.ref);
                            resolve(downloadURL);
                        } catch (error) {
                            console.error('Error getting download URL:', error);
                            reject(error);
                        }
                    }
                );
            });
        }

        // Video player functions
        function openVideoPlayer(video) {
            currentVideo = video;
            
            // Update player content
            playerVideoTitle.textContent = video.title;
            playerVideoDescription.textContent = video.description;
            playerLikesCount.textContent = video.likes || 0;
            playerDislikesCount.textContent = video.dislikes || 0;
            
            // Show delete button if user owns the video
            if (currentUser && video.uploaderId === currentUser.uid) {
                playerDeleteBtn.classList.remove('hidden');
            } else {
                playerDeleteBtn.classList.add('hidden');
            }
            
            // Update categories
            playerVideoCategories.innerHTML = '';
            video.categories.forEach(category => {
                const tag = document.createElement('span');
                tag.className = 'px-2 py-1 bg-card-bg rounded-full text-xs';
                tag.textContent = category;
                playerVideoCategories.appendChild(tag);
            });
            
            // Set video source
            fullscreenVideo.src = video.url;
            fullscreenVideoPlayer.src = video.url;
            
            // Reset player state
            fullscreenVideo.currentTime = 0;
            fullscreenVideoPlayer.currentTime = 0;
            progressBarPlayer.style.width = '0%';
            fullscreenProgressBar.style.width = '0%';
            currentTime.textContent = '0:00';
            fullscreenCurrentTime.textContent = '0:00';
            
            // Show player modal
            videoPlayerModal.style.display = 'flex';
            
            // Add to watch history
            addToHistory(video);
        }

        function closeVideoPlayer() {
            videoPlayerModal.style.display = 'none';
            fullscreenVideo.pause();
            fullscreenVideoPlayer.pause();
            currentVideo = null;
        }

        function likeVideo() {
            if (!currentVideo) return;
            
            if (!currentUser) {
                alert('Please sign in to like videos');
                return;
            }
            
            // Check if user already liked this video
            const likedIndex = likedVideos.findIndex(v => v.id === currentVideo.id);
            
            if (likedIndex === -1) {
                // Add like
                currentVideo.likes = (currentVideo.likes || 0) + 1;
                likedVideos.push(currentVideo);
                
                // Update UI
                playerLikesCount.textContent = currentVideo.likes;
                playerLikeBtn.classList.add('liked');
                
                // Remove dislike if exists
                if (currentVideo.dislikes > 0) {
                    currentVideo.dislikes--;
                    playerDislikesCount.textContent = currentVideo.dislikes;
                }
            } else {
                // Remove like
                currentVideo.likes = Math.max(0, (currentVideo.likes || 1) - 1);
                likedVideos.splice(likedIndex, 1);
                
                // Update UI
                playerLikesCount.textContent = currentVideo.likes;
                playerLikeBtn.classList.remove('liked');
            }
            
            saveData();
            
            // Update the video in the main list
            const videoIndex = videos.findIndex(v => v.id === currentVideo.id);
            if (videoIndex !== -1) {
                videos[videoIndex] = currentVideo;
                saveData();
                renderVideos();
            }
        }

        function dislikeVideo() {
            if (!currentVideo) return;
            
            if (!currentUser) {
                alert('Please sign in to dislike videos');
                return;
            }
            
            currentVideo.dislikes = (currentVideo.dislikes || 0) + 1;
            playerDislikesCount.textContent = currentVideo.dislikes;
            
            saveData();
            
            // Update the video in the main list
            const videoIndex = videos.findIndex(v => v.id === currentVideo.id);
            if (videoIndex !== -1) {
                videos[videoIndex] = currentVideo;
                saveData();
                renderVideos();
            }
        }

        function shareVideo() {
            if (!currentVideo) return;
            
            const shareUrl = window.location.href.split('?')[0] + `?video=${currentVideo.id}`;
            
            if (navigator.share) {
                navigator.share({
                    title: currentVideo.title,
                    text: currentVideo.description,
                    url: shareUrl
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(shareUrl).then(() => {
                    alert('Link copied to clipboard!');
                });
            }
        }

        function deleteVideo() {
            if (!currentVideo) return;
            
            if (confirm('Are you sure you want to delete this video?')) {
                const videoIndex = videos.findIndex(v => v.id === currentVideo.id);
                if (videoIndex !== -1) {
                    videos.splice(videoIndex, 1);
                    saveData();
                    renderVideos();
                    closeVideoPlayer();
                }
            }
        }

        // Player control functions
        function togglePlayPause() {
            if (fullscreenVideo.paused) {
                fullscreenVideo.play();
                playerPlayBtn.innerHTML = '<i data-lucide="pause" class="w-5 h-5"></i>';
                playPauseOverlay.innerHTML = '<i data-lucide="pause" class="w-8 h-8"></i>';
                lucide.createIcons();
            } else {
                fullscreenVideo.pause();
                playerPlayBtn.innerHTML = '<i data-lucide="play" class="w-5 h-5"></i>';
                playPauseOverlay.innerHTML = '<i data-lucide="play" class="w-8 h-8"></i>';
                lucide.createIcons();
            }
        }

        function toggleFullscreenPlayPause() {
            if (fullscreenVideoPlayer.paused) {
                fullscreenVideoPlayer.play();
                fullscreenPlayBtn.innerHTML = '<i data-lucide="pause" class="w-6 h-6"></i>';
                lucide.createIcons();
            } else {
                fullscreenVideoPlayer.pause();
                fullscreenPlayBtn.innerHTML = '<i data-lucide="play" class="w-6 h-6"></i>';
                lucide.createIcons();
            }
        }

        function toggleMute() {
            fullscreenVideo.muted = !fullscreenVideo.muted;
            if (fullscreenVideo.muted) {
                playerMuteBtn.innerHTML = '<i data-lucide="volume-x" class="w-5 h-5"></i>';
                volumeLevel.style.width = '0%';
            } else {
                playerMuteBtn.innerHTML = '<i data-lucide="volume-2" class="w-5 h-5"></i>';
                volumeLevel.style.width = (fullscreenVideo.volume * 100) + '%';
            }
            lucide.createIcons();
        }

        function toggleFullscreenMute() {
            fullscreenVideoPlayer.muted = !fullscreenVideoPlayer.muted;
            if (fullscreenVideoPlayer.muted) {
                fullscreenMuteBtn.innerHTML = '<i data-lucide="volume-x" class="w-6 h-6"></i>';
                fullscreenVolumeLevel.style.width = '0%';
            } else {
                fullscreenMuteBtn.innerHTML = '<i data-lucide="volume-2" class="w-6 h-6"></i>';
                fullscreenVolumeLevel.style.width = (fullscreenVideoPlayer.volume * 100) + '%';
            }
            lucide.createIcons();
        }

        function setVolume(e) {
            const rect = volumeSlider.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            const volume = Math.max(0, Math.min(1, percent));
            
            fullscreenVideo.volume = volume;
            volumeLevel.style.width = (volume * 100) + '%';
            
            if (volume === 0) {
                playerMuteBtn.innerHTML = '<i data-lucide="volume-x" class="w-5 h-5"></i>';
            } else {
                playerMuteBtn.innerHTML = '<i data-lucide="volume-2" class="w-5 h-5"></i>';
            }
            lucide.createIcons();
        }

        function setFullscreenVolume(e) {
            const rect = fullscreenVolumeSlider.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            const volume = Math.max(0, Math.min(1, percent));
            
            fullscreenVideoPlayer.volume = volume;
            fullscreenVolumeLevel.style.width = (volume * 100) + '%';
            
            if (volume === 0) {
                fullscreenMuteBtn.innerHTML = '<i data-lucide="volume-x" class="w-6 h-6"></i>';
            } else {
                fullscreenMuteBtn.innerHTML = '<i data-lucide="volume-2" class="w-6 h-6"></i>';
            }
            lucide.createIcons();
        }

        function updateVideoTime() {
            const current = fullscreenVideo.currentTime;
            const duration = fullscreenVideo.duration;
            
            if (duration) {
                const percent = (current / duration) * 100;
                progressBarPlayer.style.width = percent + '%';
                fullscreenProgressBar.style.width = percent + '%';
                
                currentTime.textContent = formatTime(current);
                fullscreenCurrentTime.textContent = formatTime(current);
                durationTime.textContent = formatTime(duration);
                fullscreenDurationTime.textContent = formatTime(duration);
            }
        }

        function updateFullscreenVideoTime() {
            const current = fullscreenVideoPlayer.currentTime;
            const duration = fullscreenVideoPlayer.duration;
            
            if (duration) {
                const percent = (current / duration) * 100;
                progressBarPlayer.style.width = percent + '%';
                fullscreenProgressBar.style.width = percent + '%';
                
                currentTime.textContent = formatTime(current);
                fullscreenCurrentTime.textContent = formatTime(current);
                durationTime.textContent = formatTime(duration);
                fullscreenDurationTime.textContent = formatTime(duration);
            }
        }

        function updateShortsVideoTime() {
            // For shorts, we don't need to show time, but we can use this for other purposes
        }

        function setProgress(e) {
            const rect = progressContainer.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            const time = percent * fullscreenVideo.duration;
            
            fullscreenVideo.currentTime = time;
            fullscreenVideoPlayer.currentTime = time;
        }

        function setFullscreenProgress(e) {
            const rect = fullscreenProgressContainer.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            const time = percent * fullscreenVideoPlayer.duration;
            
            fullscreenVideo.currentTime = time;
            fullscreenVideoPlayer.currentTime = time;
        }

        function updateProgressHover(e) {
            const rect = progressContainer.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            progressHover.style.width = (percent * 100) + '%';
        }

        function updateFullscreenProgressHover(e) {
            const rect = fullscreenProgressContainer.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            fullscreenProgressHover.style.width = (percent * 100) + '%';
        }

        function toggleQualityMenu() {
            qualityMenu.classList.toggle('show');
        }

        function toggleFullscreenQualityMenu() {
            fullscreenQualityMenu.classList.toggle('show');
        }

        function enterFullscreen() {
            videoPlayerModal.style.display = 'none';
            fullscreenPlayer.style.display = 'flex';
            
            // Sync video state
            fullscreenVideoPlayer.currentTime = fullscreenVideo.currentTime;
            if (!fullscreenVideo.paused) {
                fullscreenVideoPlayer.play();
                fullscreenPlayBtn.innerHTML = '<i data-lucide="pause" class="w-6 h-6"></i>';
            } else {
                fullscreenVideoPlayer.pause();
                fullscreenPlayBtn.innerHTML = '<i data-lucide="play" class="w-6 h-6"></i>';
            }
            lucide.createIcons();
        }

        function exitFullscreen() {
            fullscreenPlayer.style.display = 'none';
            videoPlayerModal.style.display = 'flex';
            
            // Sync video state
            fullscreenVideo.currentTime = fullscreenVideoPlayer.currentTime;
            if (!fullscreenVideoPlayer.paused) {
                fullscreenVideo.play();
                playerPlayBtn.innerHTML = '<i data-lucide="pause" class="w-5 h-5"></i>';
            } else {
                fullscreenVideo.pause();
                playerPlayBtn.innerHTML = '<i data-lucide="play" class="w-5 h-5"></i>';
            }
            lucide.createIcons();
        }

        function videoEnded() {
            playerPlayBtn.innerHTML = '<i data-lucide="play" class="w-5 h-5"></i>';
            playPauseOverlay.innerHTML = '<i data-lucide="play" class="w-8 h-8"></i>';
            lucide.createIcons();
        }

        function fullscreenVideoEnded() {
            fullscreenPlayBtn.innerHTML = '<i data-lucide="play" class="w-6 h-6"></i>';
            lucide.createIcons();
        }

        function shortsVideoEnded() {
            // For shorts, we want them to loop, so no action needed
        }

        // Shorts functions
        function openShortsPlayer(short) {
            currentShorts = short;
            
            // Set video source
            fullscreenShortsVideo.src = short.url;
            
            // Reset player state
            fullscreenShortsVideo.currentTime = 0;
            shortsLikesCount.textContent = short.likes || 0;
            
            // Show delete button if user owns the short
            if (currentUser && short.uploaderId === currentUser.uid) {
                shortsDeleteBtn.classList.remove('hidden');
            } else {
                shortsDeleteBtn.classList.add('hidden');
            }
            
            // Show fullscreen shorts player
            fullscreenShorts.style.display = 'block';
            
            // Play the video
            fullscreenShortsVideo.play();
            
            // Add to watch history
            addToHistory(short);
        }

        function closeFullscreenShorts() {
            fullscreenShorts.style.display = 'none';
            fullscreenShortsVideo.pause();
            currentShorts = null;
        }

        function likeShorts() {
            if (!currentShorts) return;
            
            if (!currentUser) {
                alert('Please sign in to like shorts');
                return;
            }
            
            // Check if user already liked this short
            const likedIndex = likedVideos.findIndex(v => v.id === currentShorts.id);
            
            if (likedIndex === -1) {
                // Add like
                currentShorts.likes = (currentShorts.likes || 0) + 1;
                likedVideos.push(currentShorts);
                
                // Update UI
                shortsLikesCount.textContent = currentShorts.likes;
                shortsLikeBtn.classList.add('liked');
            } else {
                // Remove like
                currentShorts.likes = Math.max(0, (currentShorts.likes || 1) - 1);
                likedVideos.splice(likedIndex, 1);
                
                // Update UI
                shortsLikesCount.textContent = currentShorts.likes;
                shortsLikeBtn.classList.remove('liked');
            }
            
            saveData();
            
            // Update the short in the main list
            const shortIndex = shorts.findIndex(v => v.id === currentShorts.id);
            if (shortIndex !== -1) {
                shorts[shortIndex] = currentShorts;
                saveData();
                renderShorts();
            }
        }

        function shareShorts() {
            if (!currentShorts) return;
            
            const shareUrl = window.location.href.split('?')[0] + `?shorts=${currentShorts.id}`;
            
            if (navigator.share) {
                navigator.share({
                    title: currentShorts.title,
                    text: currentShorts.description,
                    url: shareUrl
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(shareUrl).then(() => {
                    alert('Link copied to clipboard!');
                });
            }
        }

        function deleteShorts() {
            if (!currentShorts) return;
            
            if (confirm('Are you sure you want to delete this short?')) {
                const shortIndex = shorts.findIndex(v => v.id === currentShorts.id);
                if (shortIndex !== -1) {
                    shorts.splice(shortIndex, 1);
                    saveData();
                    renderShorts();
                    closeFullscreenShorts();
                }
            }
        }

        // Navigation functions
        function toggleMobileMenu() {
            const sidebar = document.getElementById('desktop-sidebar');
            const main = document.querySelector('main');
            
            if (sidebar.style.transform === 'translateX(-100%)') {
                sidebar.style.transform = 'translateX(0)';
                main.style.marginLeft = '256px';
            } else {
                sidebar.style.transform = 'translateX(-100%)';
                main.style.marginLeft = '0';
            }
        }

        function toggleMobileSearch() {
            mobileSearch.classList.toggle('hidden');
        }

        function handleNavClick(e) {
            e.preventDefault();
            const section = e.currentTarget.dataset.section;
            
            // Update active nav item
            navLinks.forEach(link => {
                if (link.dataset.section === section) {
                    link.classList.add('text-primary-red');
                    if (link.querySelector('i')) {
                        link.querySelector('i').classList.add('text-primary-red');
                    }
                } else {
                    link.classList.remove('text-primary-red');
                    if (link.querySelector('i')) {
                        link.querySelector('i').classList.remove('text-primary-red');
                    }
                }
            });
            
            // Show corresponding section
            contentSections.forEach(sectionEl => {
                if (sectionEl.id === `${section}-section`) {
                    sectionEl.classList.add('active');
                } else {
                    sectionEl.classList.remove('active');
                }
            });
            
            // Close mobile menu if open
            const sidebar = document.getElementById('desktop-sidebar');
            const main = document.querySelector('main');
            if (window.innerWidth < 768) {
                sidebar.style.transform = 'translateX(-100%)';
                main.style.marginLeft = '0';
            }
        }

        function handleCategoryFilter(e) {
            // Update active category
            categoryBtns.forEach(btn => {
                btn.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Filter videos (in a real app, this would filter the videos)
            // For now, we'll just log the category
            console.log('Filter by category:', e.target.textContent);
        }

        // Content rendering functions
        function renderVideos() {
            videosContainer.innerHTML = '';
            
            if (videos.length === 0) {
                noVideosMessage.classList.remove('hidden');
                return;
            }
            
            noVideosMessage.classList.add('hidden');
            
            videos.forEach(video => {
                const videoElement = document.createElement('div');
                videoElement.className = 'bg-card-bg rounded-lg overflow-hidden cursor-pointer transition duration-200 hover:scale-105';
                videoElement.innerHTML = `
                    <div class="relative">
                        <img src="${video.thumbnail || 'https://via.placeholder.com/320x180?text=No+Thumbnail'}" 
                             alt="${video.title}" class="w-full h-40 object-cover">
                        <div class="absolute bottom-2 right-2 bg-black bg-opacity-70 text-white text-xs px-1 rounded">
                            ${formatDuration(120)} <!-- In a real app, you would get the actual duration -->
                        </div>
                    </div>
                    <div class="p-3">
                        <h3 class="font-semibold line-clamp-2 mb-1">${video.title}</h3>
                        <p class="text-gray-400 text-sm mb-1">${video.uploader}</p>
                        <div class="flex justify-between text-gray-400 text-xs">
                            <span>${video.views} views</span>
                            <span>${formatTimeAgo(video.uploadDate)}</span>
                        </div>
                    </div>
                `;
                videoElement.addEventListener('click', () => openVideoPlayer(video));
                videosContainer.appendChild(videoElement);
            });
        }

        function renderShorts() {
            shortsContainer.innerHTML = '';
            
            if (shorts.length === 0) {
                noShortsMessage.classList.remove('hidden');
                return;
            }
            
            noShortsMessage.classList.add('hidden');
            
            shorts.forEach(short => {
                const shortElement = document.createElement('div');
                shortElement.className = 'shorts-card';
                shortElement.innerHTML = `
                    <img src="${short.thumbnail || 'https://via.placeholder.com/180x320?text=Shorts'}" 
                         alt="${short.title}" class="shorts-thumbnail">
                    <div class="shorts-info">
                        <h3 class="shorts-title">${short.title}</h3>
                        <div class="shorts-views">${short.views} views</div>
                    </div>
                `;
                shortElement.addEventListener('click', () => openShortsPlayer(short));
                shortsContainer.appendChild(shortElement);
            });
        }

        function renderHistory() {
            historyContainer.innerHTML = '';
            
            if (watchHistory.length === 0) {
                noHistoryMessage.classList.remove('hidden');
                return;
            }
            
            noHistoryMessage.classList.add('hidden');
            
            // Show only the last 10 history items
            const recentHistory = watchHistory.slice(-10).reverse();
            
            recentHistory.forEach(item => {
                const historyElement = document.createElement('div');
                historyElement.className = 'history-item';
                historyElement.innerHTML = `
                    <img src="${item.thumbnail || 'https://via.placeholder.com/160x90?text=No+Thumbnail'}" 
                         alt="${item.title}" class="history-thumbnail">
                    <div class="history-info">
                        <h3 class="font-semibold line-clamp-2 mb-1">${item.title}</h3>
                        <p class="text-gray-400 text-sm mb-1">${item.uploader}</p>
                        <p class="text-gray-500 text-xs">Watched ${formatTimeAgo(item.watchDate)}</p>
                    </div>
                `;
                historyElement.addEventListener('click', () => {
                    if (item.type === 'shorts') {
                        openShortsPlayer(item);
                    } else {
                        openVideoPlayer(item);
                    }
                });
                historyContainer.appendChild(historyElement);
            });
        }

        // Utility functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function formatDuration(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            
            if (hrs > 0) {
                return `${hrs}:${mins < 10 ? '0' : ''}${mins}:${secs < 10 ? '0' : ''}${secs}`;
            } else {
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }
        }

        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                return 'Today';
            } else if (diffDays === 1) {
                return '1 day ago';
            } else if (diffDays < 7) {
                return `${diffDays} days ago`;
            } else if (diffDays < 30) {
                const weeks = Math.floor(diffDays / 7);
                return `${weeks} week${weeks > 1 ? 's' : ''} ago`;
            } else if (diffDays < 365) {
                const months = Math.floor(diffDays / 30);
                return `${months} month${months > 1 ? 's' : ''} ago`;
            } else {
                const years = Math.floor(diffDays / 365);
                return `${years} year${years > 1 ? 's' : ''} ago`;
            }
        }

        function addToHistory(item) {
            // Check if item already exists in history
            const existingIndex = watchHistory.findIndex(i => i.id === item.id);
            
            if (existingIndex !== -1) {
                // Update watch date
                watchHistory[existingIndex].watchDate = new Date().toISOString();
            } else {
                // Add to history with current date
                const historyItem = {
                    ...item,
                    watchDate: new Date().toISOString(),
                    type: item.categories && item.categories.includes('shorts') ? 'shorts' : 'video'
                };
                watchHistory.push(historyItem);
            }
            
            // Keep only the last 50 history items
            if (watchHistory.length > 50) {
                watchHistory = watchHistory.slice(-50);
            }
            
            saveData();
            renderHistory();
        }

        function handleVideoClick(e) {
            const videoCard = e.target.closest('.bg-card-bg');
            if (videoCard) {
                const videoIndex = Array.from(videosContainer.children).indexOf(videoCard);
                if (videoIndex !== -1) {
                    openVideoPlayer(videos[videoIndex]);
                }
            }
        }

        function handleShortsClick(e) {
            const shortsCard = e.target.closest('.shorts-card');
            if (shortsCard) {
                const shortIndex = Array.from(shortsContainer.children).indexOf(shortsCard);
                if (shortIndex !== -1) {
                    openShortsPlayer(shorts[shortIndex]);
                }
            }
        }

        function handleHistoryClick(e) {
            const historyItem = e.target.closest('.history-item');
            if (historyItem) {
                const historyIndex = Array.from(historyContainer.children).indexOf(historyItem);
                if (historyIndex !== -1) {
                    const recentHistory = watchHistory.slice(-10).reverse();
                    const item = recentHistory[historyIndex];
                    
                    if (item.type === 'shorts') {
                        openShortsPlayer(item);
                    } else {
                        openVideoPlayer(item);
                    }
                }
            }
        }

        function handleKeyboardShortcuts(e) {
            // Space bar to play/pause
            if (e.code === 'Space' && 
                (videoPlayerModal.style.display === 'flex' || fullscreenPlayer.style.display === 'flex')) {
                e.preventDefault();
                if (videoPlayerModal.style.display === 'flex') {
                    togglePlayPause();
                } else {
                    toggleFullscreenPlayPause();
                }
            }
            
            // Escape to exit fullscreen
            if (e.code === 'Escape' && fullscreenPlayer.style.display === 'flex') {
                exitFullscreen();
            }
            
            // Escape to exit fullscreen shorts
            if (e.code === 'Escape' && fullscreenShorts.style.display === 'block') {
                closeFullscreenShorts();
            }
            
            // F key for fullscreen
            if (e.code === 'KeyF' && videoPlayerModal.style.display === 'flex') {
                enterFullscreen();
            }
        }

        // Initialize the app
        window.onload = function() {
            // Check if there's a video ID in the URL
            const urlParams = new URLSearchParams(window.location.search);
            const videoId = urlParams.get('video');
            const shortsId = urlParams.get('shorts');
            
            if (videoId) {
                const video = videos.find(v => v.id === videoId);
                if (video) {
                    openVideoPlayer(video);
                }
            } else if (shortsId) {
                const short = shorts.find(s => s.id === shortsId);
                if (short) {
                    openShortsPlayer(short);
                }
            }
        };
    </script>
</body>
</html>